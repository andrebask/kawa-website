<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Kawa: Data structures</title>
<link rel="stylesheet" title="Kawa (navbar: fixed, left)" href="style/kawa-l.css" media="screen, print, projection, tv">
<link rel="alternate stylesheet" title="Kawa (navbar: fixed, right)" href="style/kawa-r.css" media="screen, print, projection, tv">
<link rel="alternate stylesheet" title="Single column, top navigation" href="style/kawa-1col.css" type="text/css" media="handheld, screen, print, projection, tv">
<script language="JavaScript" type="text/javascript" src="style/utils.js"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="toc.html" title="Kawa: The Kawa Scheme language">
<link rel="up" href="Documentation.html" title="Kawa: Documentation">
<link rel="prev" href="Characters-and-text.html" title="Kawa: Characters and text">
<link rel="next" href="Eval-and-Environments.html" title="Kawa: Eval and Environments">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF" onload="javascript:onLoadHandler();" onunload="javascript:onUnloadHandler();">
<div class="navcol">
<div class="logo"><a href="index.html"><img src="style/kawa-logo.png"></a></div>
<div class="navbar">
<ul>
<li><a href="toc.html">Table of Contents</a></li>
<li><a href="tutorial/index.html">Tutorial</a></li>
<li><a href="news.html">News: Recent changes</a></li>
</ul>
<div class="toc"><ul>
<li><a href="index.html">The Kawa Scheme language</a></li>
<li><a href="Installation.html">Getting and installing Kawa</a></li>
<li><a href="Features.html">Features</a></li>
<li>
<a href="Documentation.html">Documentation</a><ul>
<li><a href="Running.html">Usage Reference</a></li>
<li><a href="Syntax.html">Syntax</a></li>
<li><a href="Program-structure.html">Program structure</a></li>
<li><a href="Multiple-values.html">Multiple values</a></li>
<li><a href="Symbols-and-namespaces.html">Symbols and namespaces</a></li>
<li><a href="Procedures.html">Procedures</a></li>
<li><a href="Numbers.html">Numbers</a></li>
<li><a href="Characters-and-text.html">Characters and text</a></li>
<li>
<b class="toc"><a href="Data-structures.html">Data structures</a></b><ul>
<li><b class="toc"><a href="Data-structures.html#Sequences">Sequences</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Lists">Lists</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Vectors">Vectors</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Uniform-vectors">Uniform vectors</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Bytevectors">Bytevectors</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Streams">Streams - lazy lists</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Arrays">Multi-dimensional Arrays</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Hash-tables">Hash tables</a></b></li>
</ul>
</li>
<li><a href="Eval-and-Environments.html">Eval and Environments</a></li>
<li><a href="Debugging.html">Debugging</a></li>
<li><a href="Input-Output.html">Input, output, files</a></li>
<li><a href="Types.html">Types</a></li>
<li><a href="Objects-Classes-and-Modules.html">Object, Classes and Modules</a></li>
<li><a href="XML-tools.html">Working with XML and HTML</a></li>
<li><a href="Miscellaneous.html">Miscellaneous topics</a></li>
</ul>
</li>
<li><a href="Development.html">Development</a></li>
<li><a href="Community.html">The Kawa Community</a></li>
<li><a href="About.html">About</a></li>
<li><a href="Overall-Index.html">Index</a></li>
</ul></div>
</div>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="Data-structures"></a>Data structures</h2></div></div></div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Sequences"></a>Sequences</h3></div></div></div>
<p>A <em class="firstterm">sequence</em> is a generalized list, consisting of zero or more values.
You can choose between a number of different kinds of sequence implementations.
Scheme traditionally has <a class="link" href="Data-structures.html#Lists" title="Kawa: Lists">lists</a> and <a class="link" href="Data-structures.html#Vectors" title="Kawa: Vectors">vectors</a>.
Any Java class that implements <code class="literal">java.util.List</code> is a sequence type.
Raw Java arrays can also be viewerd as a sequence,
and strings can be viewed a sequence (or vector) of characters.
Kawa also provides <a class="link" href="Data-structures.html#Uniform-vectors" title="Kawa: Uniform vectors">uniform vectors</a>.
</p>
<p>Sequence types differ in their API, but given a sequence type <em class="replaceable"><code>stype</code></em>
you can construct instances of that types using the syntax:
</p>
<pre class="screen">(<em class="replaceable"><code>stype</code></em> <em class="replaceable"><code>v0</code></em> <em class="replaceable"><code>v1</code></em> .... <em class="replaceable"><code>vn</code></em>)
</pre>
<p>For example:
</p>
<pre class="screen">(bytevector 9 8 7 6)  ⇒ #u8(9 8 7 6)
</pre>
<p>For a raw Java class name <em class="replaceable"><code>jname</code></em> you may need to use
the empty keyword <code class="literal">||:</code> to separate constructor parameters (if any)
from sequence elements, as in:
</p>
<pre class="screen">(gnu.lists.U8Vector ||: 9 8 7 6)  ⇒ #u8(9 8 7 6)
</pre>
<p>This syntax works with any type with a default constructor
and a 1-argument <code class="literal">add</code> method;
see <a class="xref" href="Objects-Classes-and-Modules.html#Allocating-objects" title="Kawa: Allocating objects">the section called “Allocating objects”</a> for details.
You can use the same syntax for allocating arrays,
though array creation supports <a class="link" href="Objects-Classes-and-Modules.html#Creating-new-Java-arrays">more options</a>.
</p>
<p>To extract an element from Scheme sequence of type <em class="replaceable"><code>stype</code></em>
there is usually a function <code class="literal"><em class="replaceable"><code>stype</code></em>-ref</code>.  For example:
</p>
<pre class="screen">(define vec1 (vector 5 6 7 8))
(vector-ref vec1 2) ⇒ 7
</pre>
<p>More concisely, you can use (Kawa-specific) function call syntax:
</p>
<pre class="screen">(vec1 3) ⇒ 8
</pre>
<p>The same function call syntax also works for raw Java arrays:
</p>
<pre class="screen">(define arr1 (long[] 4 5 6 7))
(arr1 3) ⇒ 7
</pre>
<p>To assign to (replace) an element from a sequence of Scheme type <em class="replaceable"><code>stype</code></em>
there is usually a function <code class="literal"><em class="replaceable"><code>stype</code></em>-set!</code>:
</p>
<pre class="screen">(vector-set! vec1 1 9)
vec1 ⇒ #(5 9 7 8)
</pre>
<p>Again, you can use the function call syntax:
</p>
<pre class="screen">(set! (vec1 2) 'x)
vec1 ⇒ #(5 9 x 8)
</pre>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Lists"></a>Lists</h3></div></div></div>
<p>A pair (sometimes called a <em class="firstterm">dotted pair</em>) is a record structure
with two fields called the car and cdr fields (for historical
reasons). Pairs are created by the procedure <code class="literal">cons</code>. The
car and cdr fields are accessed by the procedures <code class="literal">car</code> and
<code class="literal">cdr</code>. The car and cdr fields are assigned by the procedures
<code class="literal">set-car!</code> and <code class="literal">set-cdr!</code>.
</p>
<p>Pairs are used primarily to represent lists. A <em class="firstterm">list</em> can be
defined recursively as either the empty list or a pair whose
cdr is a list. More precisely, the set of lists is defined as
the smallest set <em class="replaceable"><code>X</code></em> such that:
</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem"><p>The empty list is in <em class="replaceable"><code>X</code></em>.
</p></li>
<li class="listitem"><p>If <em class="replaceable"><code>list</code></em> is in <em class="replaceable"><code>X</code></em>, then any pair whose cdr field contains
<em class="replaceable"><code>list</code></em> is also in <em class="replaceable"><code>X</code></em>.
</p></li>
</ul></div>
<p>The objects in the car fields of successive pairs of a list are
the elements of the list. For example, a two-element list
is a pair whose car is the first element and whose cdr is a
pair whose car is the second element and whose cdr is the
empty list. The length of a list is the number of elements,
which is the same as the number of pairs.
</p>
<p>The empty list is a special object of its own type. It is not
a pair, it has no elements, and its length is zero.
</p>
<p><span class="emphasis"><em>Note:</em></span> The above definitions imply that all lists have finite
length and are terminated by the empty list.
</p>
<p>The most general notation (external representation) for
Scheme pairs is the “dotted” notation <code class="literal">(<em class="replaceable"><code>c1</code></em> . <em class="replaceable"><code>c2</code></em> )</code>
where <em class="replaceable"><code>c1</code></em> is the value of the car field and
<em class="replaceable"><code>c2</code></em> is the value of the cdr field.
For example <code class="literal">(4 . 5)</code> is a pair whose car is 4 and
whose cdr is 5. Note that <code class="literal">(4 . 5)</code> is the external representation
of a pair, not an expression that evaluates to a pair.
</p>
<p>A more streamlined notation can be used for lists: the
elements of the list are simply enclosed in parentheses and
separated by spaces. The empty list is written <code class="literal">()</code>.
For example,
</p>
<pre class="screen">(a b c d e)
</pre>
<p>and
</p>
<pre class="screen">(a . (b . (c . (d . (e . ())))))
</pre>
<p>are equivalent notations for a list of symbols.
</p>
<p>A chain of pairs not ending in the empty list is called an
<em class="firstterm">improper list</em>. Note that an improper list is not a list.
The list and dotted notations can be combined to represent
improper lists:
</p>
<pre class="screen">(a b c . d)
</pre>
<p>is equivalent to
</p>
<pre class="screen">(a . (b . (c . d)))
</pre>
<p><span class="emphasis"><em>Needs to finish merging from R7RS!</em></span>
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45893872"></a><code class="function">make-list</code><em class="replaceable"><code> k</code></em> [<em class="replaceable"><code>fill</code></em>]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns a newly allocated list of <em class="replaceable"><code>k</code></em> elements.  If a second argument
is given, the each element is initialized to <em class="replaceable"><code>fill</code></em>.
Otherwise the initial contents of each element is unspecified.
</p>
<pre class="screen">(make-list 2 3)   ⇒ (3 3)
</pre>
</blockquote></div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="SRFI-1-list-library"></a>SRFI-1 list library</h4></div></div></div>
<p>The <a class="ulink" href="http://srfi.schemers.org/srfi-1/srfi-1.html" target="_top">SRFI-1 List Library</a>
is available, though not enabled by default.  To use its functions you
must <code class="literal">(require 'list-lib)</code> or <code class="literal">(require 'srfi-1)</code>.
</p>
<pre class="screen">(require 'list-lib)
(iota 5 0 -0.5) ⇒ (0.0 -0.5 -1.0 -1.5 -2.0)
</pre>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45903712"></a><code class="function">reverse!</code><em class="replaceable"><code> list</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>The result is a list consisting of the elements of <em class="replaceable"><code>list</code></em> in reverse order.
No new pairs are allocated, instead the pairs of <em class="replaceable"><code>list</code></em> are re-used,
with <code class="literal">cdr</code> cells of <em class="replaceable"><code>list</code></em> reversed in place.  Note that if <em class="replaceable"><code>list</code></em>
was pair, it becomes the last pair of the reversed result.
</p></blockquote></div>
</div>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Vectors"></a>Vectors</h3></div></div></div>
<p>Vectors are heterogeneous structures whose elements are indexed by
integers.  A vector typically occupies less space than a list of the
same length, and the average time needed to access a randomly chosen
element is typically less for the vector than for the list.
</p>
<p>The <span class="emphasis"><em>length</em></span> of a vector is the number of elements that it
contains.  This number is a non–negative integer that is fixed when the
vector is created.  The <span class="emphasis"><em>valid indices</em></span> of a vector are the exact
non–negative integer objects less than the length of the vector.  The
first element in a vector is indexed by zero, and the last element is
indexed by one less than the length of the vector.
</p>
<p>Vectors are written using the notation <code class="literal">#(<em class="replaceable"><code>obj</code></em> ...)</code>.
For example, a vector of length 3 3 containing the number zero
in element 0, the list <code class="literal">(2 2 2 2)</code> in element 1, and the
string <code class="literal">"Anna"</code> in element 2 can be written as following:
</p>
<pre class="screen">#(0 (2 2 2 2) "Anna")
</pre>
<p>Note that this is the external representation of a vector.
In Kawa, a vector datum is self-evaluating,
but for style (and compatibility with R7RS) is is suggested
you quote a vector constant:
</p>
<pre class="screen">’#(0 (2 2 2 2) "Anna")  ⇒ #(0 (2 2 2 2) "Anna")
</pre>
<p>Compare these different ways of creating a vector:
</p>
<div class="variablelist"><dl class="variablelist">
<dt class="term"><code class="literal">(vector a b c)</code></dt>
<dd><p>In this case <code class="literal">a</code>, <code class="literal">b</code>, and <code class="literal">c</code> are expressions evaluated at
run-time and the results used to initialize a newly-allocated 3-element vector.
</p></dd>
<dt class="term"><code class="literal">[a b c]</code></dt>
<dd><p>Same as using vector, but more concise, and results in an immutable
(non-modifiable) vector.
</p></dd>
<dt class="term"><code class="literal">#(a b c)</code></dt>
<dd><p>This is reader syntax and creates a vector literal,
at read-time, early in compile-time.
The symbols <code class="literal">a</code>, <code class="literal">b</code>, and <code class="literal">c</code> are not evaluated
but instead used literally.
</p></dd>
<dt class="term"><code class="literal">`#(,a ,b ,c)</code></dt>
<dd><p>This is reader-syntax, using quasi-quotation,
so <code class="literal">a</code>, <code class="literal">b</code>, and <code class="literal">c</code> are expressions evaluated at run-time.
This is equivalent to <code class="literal">[a b c]</code> in that it results in an immutable vector.
</p></dd>
</dl></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45931920"></a><code class="function">vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of vector objects.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45935120"></a><code class="function">vector</code> <em class="replaceable"><code>obj</code></em><em class="replaceable"><code> …</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Return a newly allocated vector whose elements contain the given
arguments.  Analogous to <code class="literal">list</code>.
</p>
<pre class="screen">(vector 'a 'b 'c)               ⇒  #(a b c)
</pre>
<p>Alternatively, you can use square-bracket syntax,
which results in an immutable vector:
</p>
<pre class="screen">['a 'b 'c]               ⇒  #(a b c)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45941584"></a><code class="function">make-vector</code> <em class="replaceable"><code>k</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp45944256"></a><code class="function">make-vector</code> <em class="replaceable"><code>k</code></em> <em class="replaceable"><code>fill</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return a newly allocated vector of <em class="replaceable"><code>k</code></em> elements.  If a second
argument is given, then each element is initialized to <em class="replaceable"><code>fill</code></em>.
Otherwise the initial contents of each element is <code class="literal">#!null</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45949856"></a><code class="function">vector?</code> <em class="replaceable"><code>obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return <code class="literal">#t</code> if <em class="replaceable"><code>obj</code></em> is a vector, <code class="literal">#f</code> otherwise.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45955264"></a><code class="function">vector-length</code> <em class="replaceable"><code>vector</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return the number of elements in <em class="replaceable"><code>vector</code></em> as an exact integer.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45959504"></a><code class="function">vector-ref</code> <em class="replaceable"><code>vector</code></em> <em class="replaceable"><code>k</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>It is an error if <em class="replaceable"><code>k</code></em> is not a valid index of <em class="replaceable"><code>vector</code></em>.
The <code class="literal">vector-ref</code>
procedure returns the contents of element <em class="replaceable"><code>k</code></em> of <em class="replaceable"><code>vector</code></em>.
</p>
<pre class="screen">(vector-ref '#(1 1 2 3 5 8 13 21) 5)     ⇒  8
(vector-ref '#(1 1 2 3 5 8 13 21)
  (inexact-&gt;exact (round (* 2 (acos -1)))))
⇒ 13
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45966928"></a><code class="function">vector-set!</code> <em class="replaceable"><code>vector</code></em> <em class="replaceable"><code>k</code></em> <em class="replaceable"><code>obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>It is an error if <em class="replaceable"><code>k</code></em> is not a valid index of <em class="replaceable"><code>vector</code></em>.
The <code class="literal">vector-set!</code>
procedure stores <em class="replaceable"><code>obj</code></em> in element <em class="replaceable"><code>k</code></em> of <em class="replaceable"><code>vector</code></em>, and
returns no values.
</p>
<pre class="screen">(let ((vec (vector 0 '(2 2 2 2) "Anna")))
  (vector-set! vec 1 '("Sue" "Sue"))
  vec)
  ⇒  #(0 ("Sue" "Sue") "Anna")

(vector-set! '#(0 1 2) 1 "doe")
  ⇒  <em class="wordasword">error</em>    ;; constant vector
</pre>
</blockquote></div>
</div>
<p>A concise alternative to <code class="literal">vector-ref</code> and <code class="literal">vector-set!</code>
is to use function call syntax.  For example:
</p>
<pre class="screen">(let ((vec (vector 0 '(2 2 2 2) "Anna")))
  (set! (vec 1) '("Sue" "Sue"))
  (list (vec 2) (vec 1)))
  ⇒  ("Anna" ("Sue" "Sue"))
</pre>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45978128"></a><code class="function">vector-&gt;list</code> <em class="replaceable"><code>vector</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>The <code class="literal">vector-&gt;list</code> procedure returns a newly allocated list of the
objects contained in the elements of <em class="replaceable"><code>vector</code></em>
between <em class="replaceable"><code>start</code></em> and <em class="replaceable"><code>end</code></em>.
</p>
<pre class="screen">(vector-&gt;list '#(dah dah didah))        ⇒  (dah dah didah)
(vector-&gt;list '#(dah dah didah) 1 2)    ⇒  (dah)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45985664"></a><code class="function">list-&gt;vector</code> <em class="replaceable"><code>list</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>The <code class="literal">list-&gt;vector</code> procedure returns a newly created vector
initialized to the elements of the list <em class="replaceable"><code>list</code></em>, in order.
</p>
<pre class="screen">(list-&gt;vector '(dididit dah))           ⇒  #(dididit dah)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp45991264"></a><code class="function">vector-&gt;string</code><em class="replaceable"><code> vector</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>The <code class="literal">vector-&gt;string</code> procedure returns a newly allocated
string of the objects contained in the elements of <em class="replaceable"><code>vector</code></em>
between <em class="replaceable"><code>start</code></em> and <em class="replaceable"><code>end</code></em>.
It is an error if any element of <em class="replaceable"><code>vector</code></em> between <em class="replaceable"><code>start</code></em>
and <em class="replaceable"><code>end</code></em> is not a character, or is a character forbidden in strings.
</p>
<pre class="screen">(vector-&gt;string #(#\1 #\2 #\3))             ⇒ "123"
(vector-&gt;string #(#\1 #\2 #\3 #\4 #\5) 2 4) ⇒ "34"
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46000032"></a><code class="function">string-&gt;vector</code><em class="replaceable"><code> string</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>The <code class="literal">string-&gt;vector</code> procedure
returns a newly created vector initialized to the elements
of the string <em class="replaceable"><code>string</code></em> between <em class="replaceable"><code>start</code></em> and <em class="replaceable"><code>end</code></em>.
</p>
<pre class="screen">(string-&gt;vector "ABC")       ⇒ #(#\A #\B #\C)
(string-&gt;vector "ABCDE" 1 3) ⇒ #(#\B #\C)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46007344"></a><code class="function">vector-copy</code><em class="replaceable"><code> vector</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns a newly allocated copy of the elements of the given
<em class="replaceable"><code>vector</code></em> between <em class="replaceable"><code>start</code></em> and <em class="replaceable"><code>end</code></em> . The elements of the new
vector are the same (in the sense of <code class="literal">eqv?</code>) as the elements
of the old.
</p>
<pre class="screen">(define a #(1 8 2 8)) ; a may be immutable
(define b (vector-copy a))
(vector-set! b 0 3)   ; b is mutable
b                     ⇒      #(3 8 2 8)
(define c (vector-copy b 1 3))
c                     ⇒ #(8 2)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46014784"></a><code class="function">vector-copy!</code><em class="replaceable"><code> to</code></em><em class="replaceable"><code> at</code></em><em class="replaceable"><code> from</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>Copies the elements of vector from between start and end
to vector to, starting at at. The order in which elements
are copied is unspecified, except that if the source and
destination overlap, copying takes place as if the source is first
copied into a temporary vector and then into the destination.
This can be achieved without allocating storage by making
sure to copy in the correct direction in such circumstances.
</p>
<p>It is an error if <em class="replaceable"><code>at</code></em> is less than zero or greater than the length
of <em class="replaceable"><code>to</code></em>.
It is also an error if <code class="literal">(- (vector-length <em class="replaceable"><code>to</code></em>) <em class="replaceable"><code>at</code></em>)</code> is less
than <code class="literal">(- <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>start</code></em>)</code>.
</p>
<pre class="screen">(define a (vector 1 2 3 4 5))
(define b (vector 10 20 30 40 50))
(vector-copy! b 1 a 0 2)
b    ⇒ #(10 1 2 40 50)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46025632"></a><code class="function">vector-append</code> <em class="replaceable"><code>arg</code></em><em class="replaceable"><code>...</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Creates a newly allocated vector whose elements are the
concatenation of the elements of the given arguments.
Each <em class="replaceable"><code>arg</code></em> may be a vector or a list.
</p>
<pre class="screen">(vector-append #(a b c) #(d e f))
    ⇒ #(a b c d e f)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46030688"></a><code class="function">vector-fill!</code> <em class="replaceable"><code>vector fill</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>Stores <em class="replaceable"><code>fill</code></em> in in the elements of <em class="replaceable"><code>vector</code></em>
between <em class="replaceable"><code>start</code></em> and <em class="replaceable"><code>end</code></em>.
</p>
<pre class="screen">(define a (vector 1 2 3 4 5))
(vector-fill! a 'smash 2 4)
a  ⇒ #(1 2 smash smash 5)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46037248"></a><code class="function">vector-map</code> <em class="replaceable"><code>proc</code></em> <em class="replaceable"><code>vector</code></em><em class="replaceable"><code>_1</code></em> <em class="replaceable"><code>vector</code></em><em class="replaceable"><code>_2</code></em><em class="replaceable"><code> …</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>The <em class="replaceable"><code>vector</code></em>s must all have the same length.  <em class="replaceable"><code>proc</code></em> should
accept as many arguments as there are <em class="replaceable"><code>vector</code></em>s and return a single
value.
</p>
<p>The <code class="literal">vector-map</code> procedure applies <em class="replaceable"><code>proc</code></em> element–wise to the
elements of the <em class="replaceable"><code>vector</code></em>s and returns a vector of the results, in
order.  <em class="replaceable"><code>proc</code></em> is always called in the same dynamic environment as
<code class="literal">vector-map</code> itself.  The order in which <em class="replaceable"><code>proc</code></em> is applied to
the elements of the <em class="replaceable"><code>vector</code></em>s is unspecified.  If multiple returns
occur from <code class="literal">vector-map</code>, the return values returned by earlier
returns are not mutated.
</p>
<p>Analogous to <code class="literal">map</code>.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46049936"></a><code class="function">vector-for-each</code> <em class="replaceable"><code>proc</code></em> <em class="replaceable"><code>vector</code></em><em class="replaceable"><code>_1</code></em> <em class="replaceable"><code>vector</code></em><em class="replaceable"><code>_2</code></em><em class="replaceable"><code> …</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>The <em class="replaceable"><code>vector</code></em>s must all have the same length.  <em class="replaceable"><code>proc</code></em> should
accept as many arguments as there are <em class="replaceable"><code>vector</code></em>s.  The
<code class="literal">vector-for-each</code> procedure applies <em class="replaceable"><code>proc</code></em> element–wise to the
elements of the <em class="replaceable"><code>vector</code></em>s for its side effects, in order from the
first elements to the last.  <em class="replaceable"><code>proc</code></em> is always called in the same
dynamic environment as <code class="literal">vector-for-each</code> itself.  The return values
of <code class="literal">vector-for-each</code> are unspecified.
</p>
<p>Analogous to <code class="literal">for-each</code>.
</p>
</blockquote></div>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Uniform-vectors"></a>Uniform vectors</h3></div></div></div>
<p>Uniform vectors are vectors whose elements are of the same numeric type.
The are defined by <a class="ulink" href="http://srfi.schemers.org/srfi-4/srfi-4.html" target="_top">SRFI-4</a>.
The type names (such as <code class="literal">s8vector</code>) are a Kawa extension.
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46064768"></a><code class="function">s8vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
a signed 8-bit integer.  Represented using an array of <code class="literal">byte</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46068784"></a><code class="function">u8vector</code></p>
<div class="blockquote"><blockquote class="blockquote">
<p>The type of uniform vectors where each element can contain
an unsigned 8-bit integer.  Represented using an array of <code class="literal">&lt;byte&gt;</code>,
but each element is treated as if unsigned.
</p>
<p>This type is a synonym for <code class="literal">bytevector</code>,
which has <a class="link" href="Data-structures.html#Bytevectors" title="Kawa: Bytevectors">extra functions</a>.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46074928"></a><code class="function">s16vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
a signed 16-bit integer.  Represented using an array of <code class="literal">short</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46078944"></a><code class="function">u16vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
an unsigned 16-bit integer.  Represented using an array of <code class="literal">short</code>,
but each element is treated as if unsigned.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46083024"></a><code class="function">s32vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
a signed 32-bit integer.  Represented using an array of <code class="literal">int</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46087008"></a><code class="function">u32vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
an unsigned 32-bit integer.  Represented using an array of <code class="literal">int</code>,
but each element is treated as if unsigned.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46091056"></a><code class="function">s64vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
a signed 64-bit integer.  Represented using an array of <code class="literal">long</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46095072"></a><code class="function">u64vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
an unsigned 64-bit integer.  Represented using an array of <code class="literal">long</code>,
but each element is treated as if unsigned.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46099152"></a><code class="function">f32vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
a 32-bit floating-point real.  Represented using an array of <code class="literal">float</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46103184"></a><code class="function">f64vector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of uniform vectors where each element can contain
a 64-bit floating-point real.  Represented using an array of <code class="literal">double</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46107216"></a><code class="function">s8vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46109792"></a><code class="function">u8vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46112368"></a><code class="function">s16vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46114944"></a><code class="function">u16vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46117520"></a><code class="function">s32vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46120096"></a><code class="function">u32vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46122672"></a><code class="function">s64vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46125248"></a><code class="function">u64vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46127824"></a><code class="function">f32vector?</code><em class="replaceable"><code> value</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46130400"></a><code class="function">f64vector?</code><em class="replaceable"><code> value</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return true iff <em class="replaceable"><code>value</code></em> is a uniform vector of the specified type.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46134400"></a><code class="function">make-s8vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46137488"></a><code class="function">make-u8vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46140576"></a><code class="function">make-s16vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46143664"></a><code class="function">make-u16vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46146752"></a><code class="function">make-s32vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46149840"></a><code class="function">make-u32vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46152928"></a><code class="function">make-s64vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46156016"></a><code class="function">make-u64vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46159104"></a><code class="function">make-f32vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<p class="synopsis"><a class="indexterm" name="idp46162192"></a><code class="function">make-f64vector</code><em class="replaceable"><code> n</code></em> [<em class="replaceable"><code>value</code></em>]</p>
<div class="blockquote"><blockquote class="blockquote"><p>Create a new uniform vector of the specified type,
having room for <em class="replaceable"><code>n</code></em> elements.
Initialize each element to <em class="replaceable"><code>value</code></em> if it is specified; zero otherwise.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46167168"></a><code class="function">s8vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46170032"></a><code class="function">u8vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46172896"></a><code class="function">s16vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ..</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46175776"></a><code class="function">u16vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46178640"></a><code class="function">s32vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46181504"></a><code class="function">u32vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46184368"></a><code class="function">s64vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46187232"></a><code class="function">u64vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46190096"></a><code class="function">f32vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46192960"></a><code class="function">f64vector</code><em class="replaceable"><code> value</code></em><em class="replaceable"><code> ...</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Create a new uniform vector of the specified type,
whose length is the number of <em class="replaceable"><code>value</code></em>s specified,
and initialize it using those <em class="replaceable"><code>value</code></em>s.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46197728"></a><code class="function">s8vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46200320"></a><code class="function">u8vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46202864"></a><code class="function">s16vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46205408"></a><code class="function">u16vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46207952"></a><code class="function">s32vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46210496"></a><code class="function">u32vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46213040"></a><code class="function">s64vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46215584"></a><code class="function">u64vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46218128"></a><code class="function">f32vector-length</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46220672"></a><code class="function">f64vector-length</code><em class="replaceable"><code> v</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return the length (in number of elements) of the uniform vector <em class="replaceable"><code>v</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46224640"></a><code class="function">s8vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46227440"></a><code class="function">u8vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46230240"></a><code class="function">s16vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46233040"></a><code class="function">u16vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46235840"></a><code class="function">s32vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46238640"></a><code class="function">u32vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46241440"></a><code class="function">s64vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46244240"></a><code class="function">u64vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46247040"></a><code class="function">f32vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46249840"></a><code class="function">f64vector-ref</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return the element at index <em class="replaceable"><code>i</code></em> of the uniform vector <em class="replaceable"><code>v</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46254400"></a><code class="function">s8vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46257456"></a><code class="function">u8vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46260512"></a><code class="function">s16vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46263568"></a><code class="function">u16vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46266624"></a><code class="function">s32vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46269680"></a><code class="function">u32vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46272736"></a><code class="function">s64vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46275792"></a><code class="function">u64vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46278848"></a><code class="function">f32vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46281904"></a><code class="function">f64vector-set!</code><em class="replaceable"><code> v</code></em><em class="replaceable"><code> i</code></em><em class="replaceable"><code> x</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Set the element at index <em class="replaceable"><code>i</code></em> of uniform vector <em class="replaceable"><code>v</code></em>
to the value <em class="replaceable"><code>x</code></em>, which must be a number coercible
to the appropriate type.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46287216"></a><code class="function">s8vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46289760"></a><code class="function">u8vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46292304"></a><code class="function">s16vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46294848"></a><code class="function">u16vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46297392"></a><code class="function">s32vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46299936"></a><code class="function">u32vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46302480"></a><code class="function">s64vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46305024"></a><code class="function">u64vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46307568"></a><code class="function">f32vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46310112"></a><code class="function">f64vector-&gt;list</code><em class="replaceable"><code> v</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Convert the uniform vetor <em class="replaceable"><code>v</code></em> to a list containing the elments of <em class="replaceable"><code>v</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46314432"></a><code class="function">list-&gt;s8vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46317088"></a><code class="function">list-&gt;u8vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46319696"></a><code class="function">list-&gt;s16vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46322304"></a><code class="function">list-&gt;u16vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46324912"></a><code class="function">list-&gt;s32vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46327520"></a><code class="function">list-&gt;u32vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46330128"></a><code class="function">list-&gt;s64vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46332736"></a><code class="function">list-&gt;u64vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46335344"></a><code class="function">list-&gt;f32vector</code><em class="replaceable"><code> l</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46337952"></a><code class="function">list-&gt;f64vector</code><em class="replaceable"><code> l</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Create a uniform vector of the appropriate type, initializing it
with the elements of the list <em class="replaceable"><code>l</code></em>.  The elements of <em class="replaceable"><code>l</code></em>
must be numbers coercible the new vector's element type.
</p></blockquote></div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Relationship-with-Java-arrays"></a>Relationship with Java arrays</h4></div></div></div>
<p>Each uniform array type is implemented as an <em class="firstterm">underlying Java array</em>,
and a length field.
The underlying type is
<code class="literal">byte[]</code> for <code class="literal">u8vector</code> or <code class="literal">s8vector</code>;
<code class="literal">short[]</code> for <code class="literal">u16vector</code> or <code class="literal">u16vector</code>;
<code class="literal">int[]</code> for <code class="literal">u32vector</code> or <code class="literal">s32vector</code>;
<code class="literal">long[]</code> for <code class="literal">u64vector</code> or <code class="literal">s64vector</code>;
<code class="literal">float[]</code> for <code class="literal">f32vector</code>; and
<code class="literal">double[]</code> for <code class="literal">f32vector</code>.
The length field allows a uniform array to only use the
initial part of the underlying array.  (This can be used
to support Common Lisp's fill pointer feature.)
This also allows resizing a uniform vector.  There is no
Scheme function for this, but you can use the <code class="literal">setSize</code> method:
</p>
<pre class="screen">(invoke some-vector 'setSize 200)
</pre>
<p>If you have a Java array, you can create a uniform vector
sharing with the Java array:
</p>
<pre class="screen">(define arr :: byte[] ((primitive-array-new byte) 10))
(define vec :: u8vector (make u8vector arr))
</pre>
<p>At this point <code class="literal">vec</code> uses <code class="literal">arr</code> for its underlying storage,
so changes to one affect the other.
It <code class="literal">vec</code> is re-sized so it needs a larger underlying array,
then it will no longer use <code class="literal">arr</code>.
</p>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Bytevectors"></a>Bytevectors</h3></div></div></div>
<p><em class="firstterm">Bytevectors</em> represent blocks of binary data. They are
fixed-length sequences of bytes, where a <em class="replaceable"><code>byte</code></em> is an exact
integer in the range [0, 255]. A bytevector is typically more
space-efficient than a vector containing the same values.
</p>
<p>The length of a bytevector is the number of elements that
it contains. This number is a non-negative integer that is
fixed when the bytevector is created. The valid indexes of
a bytevector are the exact non-negative integers less than
the length of the bytevector, starting at index zero as with
vectors.
</p>
<p>The <code class="literal">bytevector</code> type is equivalent to the <code class="literal">u8vector</code>
<a class="link" href="Data-structures.html#Uniform-vectors" title="Kawa: Uniform vectors">uniform vector</a> type, but is specified
by the R7RS standard.
</p>
<p>Bytevectors are written using the notation <code class="literal">#u8(byte . . . )</code>.
For example, a bytevector of length 3 containing the byte
0 in element 0, the byte 10 in element 1, and the byte 5 in
element 2 can be written as following:
</p>
<pre class="screen">#u8(0 10 5)
</pre>
<p>Bytevector constants are self-evaluating, so they do not
need to be quoted in programs.
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46370192"></a><code class="function">bytevector</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The type of bytevector objects.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46373440"></a><code class="function">bytevector</code> <em class="replaceable"><code>byte</code></em><em class="replaceable"><code> …</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Return a newly allocated bytevector whose elements contain the given
arguments.  Analogous to <code class="literal">vector</code>.
</p>
<pre class="screen">(bytevector 1 3 5 1 3 5)  ⇒  #u8(1 3 5 1 3 5)
(bytevector)  ⇒  #u8()
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46378816"></a><code class="function">bytevector?</code> <em class="replaceable"><code>obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return <code class="literal">#t</code> if <em class="replaceable"><code>obj</code></em> is a bytevector, <code class="literal">#f</code> otherwise.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46384224"></a><code class="function">make-bytevector</code><em class="replaceable"><code> k</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46386768"></a><code class="function">make-bytevector</code><em class="replaceable"><code> k</code></em><em class="replaceable"><code> byte</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>The <code class="literal">make-bytevector</code> procedure returns a newly allocated
bytevector of length <em class="replaceable"><code>k</code></em>. If <em class="replaceable"><code>byte</code></em> is given, then all elements
of the bytevector are initialized to <em class="replaceable"><code>byte</code></em>,
otherwise the contents of each element are unspecified.
</p>
<pre class="screen">(make-bytevector 2 12) ⇒ #u8(12 12)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46393248"></a><code class="function">bytevector-length</code><em class="replaceable"><code> bytevector</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns the length of <em class="replaceable"><code>bytevector</code></em> in bytes
as an exact integer.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46397232"></a><code class="function">bytevector-u8-ref</code><em class="replaceable"><code> bytevector</code></em><em class="replaceable"><code> k</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>It is an error if <em class="replaceable"><code>k</code></em> is not a valid index of <em class="replaceable"><code>bytevector</code></em>.
Returns the <em class="replaceable"><code>k</code></em>th byte of <em class="replaceable"><code>bytevector</code></em>.
</p>
<pre class="screen">(bytevector-u8-ref ’#u8(1 1 2 3 5 8 13 21) 5)
  ⇒ 8
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46403440"></a><code class="function">bytevector-u8-set!</code><em class="replaceable"><code> bytevector</code></em><em class="replaceable"><code> k</code></em><em class="replaceable"><code> byte</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>It is an error if <em class="replaceable"><code>k</code></em> is not a valid index of <em class="replaceable"><code>bytevector</code></em>.
Stores <em class="replaceable"><code>byte</code></em> as the <em class="replaceable"><code>k</code></em>th byte of <em class="replaceable"><code>bytevector</code></em>.
</p>
<pre class="screen">(let ((bv (bytevector 1 2 3 4)
  (bytevector-u8-set! bv 1 3)
  bv)
  ⇒ #u8(1 3 3 4)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46410320"></a><code class="function">bytevector-copy</code><em class="replaceable"><code> bytevector</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns a newly allocated bytevector containing the bytes
in <em class="replaceable"><code>bytevector</code></em> between <em class="replaceable"><code>start</code></em> and <em class="replaceable"><code>end</code></em>.
</p>
<pre class="screen">(define a #u8(1 2 3 4 5))
(bytevector-copy a 2 4))
    ⇒ #u8(3 4)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46416752"></a><code class="function">bytevector-copy!</code><em class="replaceable"><code> to</code></em><em class="replaceable"><code> at</code></em><em class="replaceable"><code> from</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>Copies the bytes of bytevector<em class="replaceable"><code>from</code></em> between <em class="replaceable"><code>start</code></em> and <em class="replaceable"><code>end</code></em>
to bytevector <em class="replaceable"><code>to</code></em>, starting at <em class="replaceable"><code>at</code></em>. The order in which bytes
are copied is unspecified, except that if the source and destination overlap,
copying takes place as if the source is first
copied into a temporary bytevector and then into the destination.
This is achieved without allocating storage
by making sure to copy in the correct direction in such
circumstances.
</p>
<p>It is an error if <em class="replaceable"><code>at</code></em> is less than zero or greater than the length
of <em class="replaceable"><code>to</code></em>.
It is also an error if <code class="literal">(- (bytevector-length <em class="replaceable"><code>to</code></em>) <em class="replaceable"><code>at</code></em>)</code>
is less than <code class="literal">(- <em class="replaceable"><code>end</code></em> <em class="replaceable"><code>start</code></em>)</code>.
</p>
<pre class="screen">(define a (bytevector 1 2 3 4 5))
(define b (bytevector 10 20 30 40 50))
(bytevector-copy! b 1 a 0 2)
b        ⇒ #u8(10 1 2 40 50)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46429168"></a><code class="function">bytevector-append</code><em class="replaceable"><code> bytevector...</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns a newly allocated bytevector whose elements are
the concatenation of the elements in the given bytevectors.
</p>
<pre class="screen">(bytevector-append #u8(0 1 2) #u8(3 4 5))
        ⇒  #u8(0 1 2 3 4 5)
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46433600"></a><code class="function">utf8-&gt;string</code><em class="replaceable"><code> bytevector</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>This procedure decodes the bytes of a bytevector between <em class="replaceable"><code>start</code></em>
and <em class="replaceable"><code>end</code></em>, interpreting as a UTF-8-encoded string,
and returns the corresponding string.
It is an error for <em class="replaceable"><code>bytevector</code></em> to contain invalid UTF-8 byte sequences.
</p>
<pre class="screen">(utf8-&gt;string #u8(#x41))  ⇒ "A"
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46440128"></a><code class="function">string-&gt;utf8</code><em class="replaceable"><code> string</code></em> [<em class="replaceable"><code>start</code></em> [<em class="replaceable"><code>end</code></em>]]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>This procedure encodes the characters of a string between
<em class="replaceable"><code>start</code></em> and <em class="replaceable"><code>end</code></em> and returns the corresponding bytevector,
in UTF-8 encoding.
</p>
<pre class="screen">(string-&gt;utf8 "λ")     ⇒ " #u8(#xCE #xBB)
</pre>
</blockquote></div>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Streams"></a>Streams - lazy lists</h3></div></div></div>
<p>Streams, sometimes called lazy lists, are a sequential data structure
containing elements computed only on demand. A stream is either null
or is a pair with a stream in its cdr. Since elements of a stream are
computed only when accessed, streams can be infinite. Once computed,
the value of a stream element is cached in case it is needed again.
</p>
<p><span class="emphasis"><em>Note:</em></span> These are not the same as Java 8 streams.
</p>
<pre class="screen">(require 'srfi-41)
(define fibs
  (stream-cons 1
    (stream-cons 1
      (stream-map +
        fibs
        (stream-cdr fibs)))))
(stream-&gt;list 8 fibs) ⇒ (1 1 2 3 5 8 13 21)
</pre>
<p>See the <a class="ulink" href="http://srfi.schemers.org/srfi-41/srfi-41.html" target="_top">SRFI 41 specification</a> for details.
</p>
<p>The Kawa implementations builds on <a class="link" href="Program-structure.html#Lazy-evaluation" title="Kawa: Lazy evaluation">promises</a>.
The <code class="literal">stream-null</code> value is a promise that evaluates to the empty list.
The result of <code class="literal">stream-cons</code> is an eager immutable pair whose
<code class="literal">car</code> and <code class="literal">cdr</code> properties return promises.
</p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Arrays"></a>Multi-dimensional Arrays</h3></div></div></div>
<p>Arrays are heterogeneous data structures whose elements are indexed by
integer sequences of fixed length.  The length of a valid index sequence
is the rank or the number of dimensions of an array. The shape of an
array consists of bounds for each index.
</p>
<p>The lower bound <em class="replaceable"><code>b</code></em> and the upper bound <em class="replaceable"><code>e</code></em> of a dimension are
exact integers with <code class="literal">(&lt;= <em class="replaceable"><code>b</code></em> <em class="replaceable"><code>e</code></em>)</code>. A valid index along the
dimension is an exact integer <em class="replaceable"><code>k</code></em> that satisfies both
<code class="literal">(&lt;= <em class="replaceable"><code>b</code></em> <em class="replaceable"><code>k</code></em>)</code> and <code class="literal">(&lt; <em class="replaceable"><code>k</code></em> <em class="replaceable"><code>e</code></em>)</code>.
The length of the array along the dimension is the difference
<code class="literal">(- <em class="replaceable"><code>e</code></em> <em class="replaceable"><code>b</code></em>)</code>.
The size of an array is the product of the lengths of its dimensions.
</p>
<p>A shape is specified as an even number of exact integers. These are
alternately the lower and upper bounds for the dimensions of an array.
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46465664"></a><code class="function">array?</code><em class="replaceable"><code> obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns <code class="literal">#t</code> if <em class="replaceable"><code>obj</code></em> is an array, otherwise returns <code class="literal">#f</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46470960"></a><code class="function">shape</code><em class="replaceable"><code> bound</code></em><em class="replaceable"><code> ...</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns a shape. The sequence <em class="replaceable"><code>bound</code></em> ... must consist of an even number
of exact integers that are pairwise not decreasing. Each pair gives the
lower and upper bound of a dimension.
If the shape is used to specify the dimensions of an array
and <em class="replaceable"><code>bound</code></em> ... is the sequence <em class="replaceable"><code>b0</code></em> <em class="replaceable"><code>e0</code></em> ... <em class="replaceable"><code>bk</code></em> <em class="replaceable"><code>ek</code></em>
... of <em class="replaceable"><code>n</code></em> pairs of bounds, then a valid index to the array is any
sequence <em class="replaceable"><code>j0</code></em> ... <em class="replaceable"><code>jk</code></em> ... of <em class="replaceable"><code>n</code></em> exact integers where
each <em class="replaceable"><code>jk</code></em> satisfies <code class="literal">(&lt;= <em class="replaceable"><code>bk</code></em> <em class="replaceable"><code>jk</code></em>)</code>
and <code class="literal">(&lt; <em class="replaceable"><code>jk</code></em> <em class="replaceable"><code>ek</code></em>)</code>.
</p>
<p>The shape of a <em class="replaceable"><code>d</code></em>-dimensional array is a <em class="replaceable"><code>d</code></em> * 2 array
where the element at <em class="replaceable"><code>k 0</code></em> contains the lower bound for an index along
dimension <em class="replaceable"><code>k</code></em> and the element at <em class="replaceable"><code>k 1</code></em> contains the
corresponding upper bound, where <em class="replaceable"><code>k</code></em> satisfies <code class="literal">(&lt;=  0 <em class="replaceable"><code>k</code></em>)</code>
and <code class="literal">(&lt; <em class="replaceable"><code>k</code></em> <em class="replaceable"><code>d</code></em>)</code>.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46488416"></a><code class="function">make-array</code><em class="replaceable"><code> shape</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46490992"></a><code class="function">make-array</code><em class="replaceable"><code> shape</code></em><em class="replaceable"><code> obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a newly allocated array whose shape is given by<em class="replaceable"><code> shape</code></em>.
If <em class="replaceable"><code>obj</code></em> is provided, then each element is initialized to it.
Otherwise the initial contents of each element is unspecified.
The array does not retain a reference to <em class="replaceable"><code>shape</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46496256"></a><code class="function">array</code><em class="replaceable"><code> shape</code></em><em class="replaceable"><code> obj</code></em><em class="replaceable"><code> ...</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a new array whose shape is given by <em class="replaceable"><code>shape</code></em> and the initial
contents of the elements are <em class="replaceable"><code>obj</code></em> ... in row major order. The array does
not retain a reference to <em class="replaceable"><code>shape</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46501744"></a><code class="function">array-rank</code><em class="replaceable"><code> array</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns the number of dimensions of <em class="replaceable"><code>array</code></em>.
</p>
<pre class="screen">(array-rank
  (make-array (shape 1 2 3 4)))
</pre>
<p>Returns 2.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46506576"></a><code class="function">array-start</code><em class="replaceable"><code> array</code></em><em class="replaceable"><code> k</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns the lower bound for the index along dimension <em class="replaceable"><code>k</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46510768"></a><code class="function">array-end</code><em class="replaceable"><code> array</code></em><em class="replaceable"><code> k</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns the upper bound for the index along dimension <em class="replaceable"><code>k</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46514960"></a><code class="function">array-ref</code><em class="replaceable"><code> array</code></em><em class="replaceable"><code> k</code></em><em class="replaceable"><code> ...</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46518080"></a><code class="function">array-ref</code><em class="replaceable"><code> array</code></em><em class="replaceable"><code> index</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns the contents of the element of <em class="replaceable"><code>array</code></em> at index <em class="replaceable"><code>k</code></em> ....
The sequence <em class="replaceable"><code>k</code></em> ... must be a valid index to <em class="replaceable"><code>array</code></em>.
In the second form, <em class="replaceable"><code>index</code></em> must be either a vector or a
0-based 1-dimensional array containing <em class="replaceable"><code>k</code></em> ....
</p>
<pre class="screen">(array-ref (array (shape 0 2 0 3)
              'uno 'dos 'tres
              'cuatro 'cinco 'seis)
   1 0)
</pre>
<p>Returns <code class="literal">cuatro</code>.
</p>
<pre class="screen">(let ((a (array (shape 4 7 1 2) 3 1 4)))
   (list (array-ref a 4 1)
         (array-ref a (vector 5 1))
         (array-ref a (array (shape 0 2)
                         6 1))))
</pre>
<p>Returns <code class="literal">(3 1 4)</code>.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46527888"></a><code class="function">array-set!</code><em class="replaceable"><code> array</code></em><em class="replaceable"><code> k</code></em><em class="replaceable"><code> ...</code></em><em class="replaceable"><code> obj</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46531296"></a><code class="function">array-set!</code><em class="replaceable"><code> array</code></em><em class="replaceable"><code> index</code></em><em class="replaceable"><code> obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Stores <em class="replaceable"><code>obj</code></em> in the element of <em class="replaceable"><code>array</code></em> at index <em class="replaceable"><code>k</code></em> ....
Returns the void value.
The sequence <em class="replaceable"><code>k</code></em> ... must be a valid index to <em class="replaceable"><code>array</code></em>.
In the second form, <em class="replaceable"><code>index</code></em> must be either a vector or a
0-based 1-dimensional array containing <em class="replaceable"><code>k</code></em> ....
</p>
<pre class="screen">(let ((a (make-array
            (shape 4 5 4 5 4 5))))
   (array-set! a 4 4 4 "huuhkaja")
   (array-ref a 4 4 4))
</pre>
<p>Returns <code class="literal">"huuhkaja"</code>.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46540304"></a><code class="function">share-array</code><em class="replaceable"><code> array</code></em><em class="replaceable"><code> shape</code></em><em class="replaceable"><code> proc</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns a new array of <em class="replaceable"><code>shape</code></em> shape that shares elements of <em class="replaceable"><code>array</code></em>
through <em class="replaceable"><code>proc</code></em>. The procedure <em class="replaceable"><code>proc</code></em> must implement an affine
function that returns indices of <em class="replaceable"><code>array</code></em> when given indices of the
array returned by <code class="literal">share-array</code>.
The array does not retain a reference to <em class="replaceable"><code>shape</code></em>.
</p>
<pre class="screen">(define i_4
   (let* ((i (make-array
                (shape 0 4 0 4)
                0))
          (d (share-array i
                (shape 0 4)
                (lambda (k)
                   (values k k)))))
      (do ((k 0 (+ k 1)))
          ((= k 4))
         (array-set! d k 1))
      i))
</pre>
<p>Note: the affinity requirement for <em class="replaceable"><code>proc</code></em> means that each value must
be a sum of multiples of the arguments passed to <em class="replaceable"><code>proc</code></em>, plus a constant.
</p>
<p>Implementation note: arrays have to maintain an internal index mapping
from indices <em class="replaceable"><code>k1</code></em> ... <em class="replaceable"><code>kd</code></em> to a single index into a backing vector;
the composition of this mapping and <em class="replaceable"><code>proc</code></em> can be recognised
as <code class="literal">(<em class="replaceable"><code>+ n0</code></em> (* <em class="replaceable"><code>n1</code></em> <em class="replaceable"><code>k1</code></em>) ... (* <em class="replaceable"><code>nd</code></em> <em class="replaceable"><code>kd</code></em>))</code>
by setting each index in turn to 1 and others to 0,
and all to 0 for the constant term; the composition can then be compiled
away, together with any complexity that the user introduced in their
procedure.
</p>
</blockquote></div>
</div>
<p>Multi-dimensional arrays are specified
by <a class="ulink" href="http://srfi.schemers.org/srfi-25/srfi-25.html" target="_top">SRFI-25</a>.
In Kawa, a one-dimensional array whose lower bound is 0 is also a sequence.
Furthermore, if such an array is simple (not created <code class="literal">share-array</code>)
it will be implemented using a <code class="literal">&lt;vector&gt;</code>.
Uniform vectors and strings are also arrays in Kawa.
For example:
</p>
<pre class="screen">(share-array
 (f64vector 1.0 2.0 3.0 4.0 5.0 6.0)
 (shape 0 2 0 3)
 (lambda (i j) (+ (* 2 i) j)))
</pre>
<p>evaluates to a two-dimensionsal array of <code class="literal">&lt;double&gt;</code>:
</p>
<pre class="screen">#2a((1.0 2.0 3.0) (3.0 4.0 5.0))
</pre>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Hash-tables"></a>Hash tables</h3></div></div></div>
<p>A <em class="firstterm">hashtable</em> is a data structure that
associates keys with values.
The hashtable has no intrinsic order for the (key, value) associations
it contains, and
supports in-place modification as the primary means of setting the contents
of a hash table.
Any object can be used as a key, provided a <em class="firstterm">hash function</em> and a suitable
<em class="firstterm">equivalence function</em> is available.
A hash function is a procedure that
maps keys to exact integer objects.
</p>
<p>The hashtable provides key lookup and destructive update in amortised
constant time, provided that a good hash function is used.
A hash function <em class="replaceable"><code>h</code></em> is acceptable for an equivalence predicate <em class="replaceable"><code>e</code></em> iff
<code class="literal">(<em class="replaceable"><code>e</code></em> <em class="replaceable"><code>obj1</code></em> <em class="replaceable"><code>obj2</code></em>)</code> implies
<code class="literal">(= (<em class="replaceable"><code>h</code></em> <em class="replaceable"><code>obj1</code></em>) (<em class="replaceable"><code>h</code></em> <em class="replaceable"><code>obj2</code></em>))</code>.
A hash function <em class="replaceable"><code>h</code></em> is good for a equivalence predicate <em class="replaceable"><code>e</code></em> if
it distributes the resulting hash values for non-equal objects
(by <em class="replaceable"><code>e</code></em>) as uniformly as possible over the range of hash
values, especially in the case when some (non-equal) objects resemble
each other by e.g. having common subsequences. This definition is
vague but should be enough to assert that e.g. a constant function is
not a good hash function.
</p>
<p>Kawa provides two complete sets of functions for hashtables:
</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem"><p>The functions specified by R6RS have names starting with <code class="literal">hashtable-</code>
</p></li>
<li class="listitem"><p>The functions specified by the older
<a class="ulink" href="http://srfi.schemers.org/srfi-69/srfi-69.html" target="_top">SRFI-69</a> specifiation
have names starting with <code class="literal">hash-table-</code>
</p></li>
</ul></div>
<p>Both interfaces use the same underlying datatype, so it is possible
to mix and match from both sets.
That datatype implements <code class="literal">java.util.Map</code>.



Freshly-written code should probably use the R6RS functions.
</p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="R6RS-hash-tables"></a>R6RS hash tables</h4></div></div></div>
<p>To use these hash table functions in your Kawa program you must first:
</p>
<pre class="screen">(import (rnrs hashtables))
</pre>
<p>This section uses the <em class="replaceable"><code>hashtable</code></em> parameter name for arguments that
must be hashtables, and the <em class="replaceable"><code>key</code></em> parameter name for arguments that
must be hashtable keys.
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46580944"></a><code class="function">make-eq-hashtable</code></p>
<p class="synopsis"><a class="indexterm" name="idp46583232"></a><code class="function">make-eq-hashtable</code> <em class="replaceable"><code>k</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return a newly allocated mutable hashtable that accepts arbitrary
objects as keys, and compares those keys with <code class="literal">eq?</code>.  If an
argument is given, the initial capacity of the hashtable is set to
approximately <em class="replaceable"><code>k</code></em> elements.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46588128"></a><code class="function">make-eqv-hashtable</code></p>
<p class="synopsis"><a class="indexterm" name="idp46590416"></a><code class="function">make-eqv-hashtable</code> <em class="replaceable"><code>k</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return a newly allocated mutable hashtable that accepts arbitrary
objects as keys, and compares those keys with <code class="literal">eqv?</code>.  If an
argument is given, the initial capacity of the hashtable is set to
approximately <em class="replaceable"><code>k</code></em> elements.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46595344"></a><code class="function">make-hashtable</code> <em class="replaceable"><code>hash-function</code></em> <em class="replaceable"><code>equiv</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46598464"></a><code class="function">make-hashtable</code> <em class="replaceable"><code>hash-function</code></em> <em class="replaceable"><code>equiv</code></em> <em class="replaceable"><code>k</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p><em class="replaceable"><code>hash-function</code></em> and <em class="replaceable"><code>equiv</code></em> must be procedures.
<em class="replaceable"><code>hash-function</code></em> should accept a key as an argument and should return
a non–negative exact integer object.  <em class="replaceable"><code>equiv</code></em> should accept two
keys as arguments and return a single value.  Neither procedure should
mutate the hashtable returned by <code class="literal">make-hashtable</code>.
</p>
<p>The <code class="literal">make-hashtable</code> procedure returns a newly allocated mutable
hashtable using <em class="replaceable"><code>hash-function</code></em> as the hash function and <em class="replaceable"><code>equiv</code></em>
as the equivalence function used to compare keys.  If a third argument
is given, the initial capacity of the hashtable is set to approximately
<em class="replaceable"><code>k</code></em> elements.
</p>
<p>Both <em class="replaceable"><code>hash-function</code></em> and <em class="replaceable"><code>equiv</code></em> should behave like pure
functions on the domain of keys.  For example, the <code class="literal">string-hash</code>
and <code class="literal">string=?</code> procedures are permissible only if all keys are
strings and the contents of those strings are never changed so long as
any of them continues to serve as a key in the hashtable.  Furthermore,
any pair of keys for which <em class="replaceable"><code>equiv</code></em> returns true should be hashed to
the same exact integer objects by <em class="replaceable"><code>hash-function</code></em>.
</p>
<div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Note:</em></span> Hashtables are allowed to cache the results of calling the
hash function and equivalence function, so programs cannot rely on the
hash function being called for every lookup or update.  Furthermore any
hashtable operation may call the hash function more than once.
</p></blockquote></div>
</blockquote></div>
</div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Procedures"></a>Procedures</h4></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46614288"></a><code class="function">hashtable?</code> <em class="replaceable"><code>obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return <code class="literal">#t</code> if <em class="replaceable"><code>obj</code></em> is a hashtable, <code class="literal">#f</code> otherwise.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46619696"></a><code class="function">hashtable-size</code> <em class="replaceable"><code>hashtable</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return the number of keys contained in <em class="replaceable"><code>hashtable</code></em> as an exact
integer object.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46623824"></a><code class="function">hashtable-ref</code> <em class="replaceable"><code>hashtable</code></em> <em class="replaceable"><code>key</code></em> <em class="replaceable"><code>default</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return the value in <em class="replaceable"><code>hashtable</code></em> associated with <em class="replaceable"><code>key</code></em>.  If
<em class="replaceable"><code>hashtable</code></em> does not contain an association for <em class="replaceable"><code>key</code></em>,
<em class="replaceable"><code>default</code></em> is returned.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46630432"></a><code class="function">hashtable-set!</code> <em class="replaceable"><code>hashtable</code></em> <em class="replaceable"><code>key</code></em> <em class="replaceable"><code>obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Change <em class="replaceable"><code>hashtable</code></em> to associate <em class="replaceable"><code>key</code></em> with <em class="replaceable"><code>obj</code></em>, adding a
new association or replacing any existing association for <em class="replaceable"><code>key</code></em>, and
returns unspecified values.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46636608"></a><code class="function">hashtable-delete!</code> <em class="replaceable"><code>hashtable</code></em> <em class="replaceable"><code>key</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Remove any association for <em class="replaceable"><code>key</code></em> within <em class="replaceable"><code>hashtable</code></em> and returns
unspecified values.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46641536"></a><code class="function">hashtable-contains?</code> <em class="replaceable"><code>hashtable</code></em> <em class="replaceable"><code>key</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return <code class="literal">#t</code> if <em class="replaceable"><code>hashtable</code></em> contains an association for <em class="replaceable"><code>key</code></em>,
<code class="literal">#f</code> otherwise.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46647792"></a><code class="function">hashtable-update!</code> <em class="replaceable"><code>hashtable</code></em> <em class="replaceable"><code>key</code></em> <em class="replaceable"><code>proc</code></em> <em class="replaceable"><code>default</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p><em class="replaceable"><code>proc</code></em> should accept one argument, should return a single value, and
should not mutate <em class="replaceable"><code>hashtable</code></em>.
</p>
<p>The <code class="literal">hashtable-update!</code> procedure applies <em class="replaceable"><code>proc</code></em> to the value
in <em class="replaceable"><code>hashtable</code></em> associated with <em class="replaceable"><code>key</code></em>, or to <em class="replaceable"><code>default</code></em> if
<em class="replaceable"><code>hashtable</code></em> does not contain an association for <em class="replaceable"><code>key</code></em>.  The
<em class="replaceable"><code>hashtable</code></em> is then changed to associate <em class="replaceable"><code>key</code></em> with the value
returned by <em class="replaceable"><code>proc</code></em>.
</p>
<p>The behavior of <code class="literal">hashtable-update!</code> is equivalent to the following
code, but is may be (and is in Kawa) implemented more efficiently in cases
where the implementation can avoid multiple lookups of the same key:
</p>
<pre class="screen">(hashtable-set!
  hashtable key
  (proc (hashtable-ref
         hashtable key default)))
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46660576"></a><code class="function">hashtable-copy</code> <em class="replaceable"><code>hashtable</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46663280"></a><code class="function">hashtable-copy</code> <em class="replaceable"><code>hashtable</code></em> <em class="replaceable"><code>mutable</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return a copy of <em class="replaceable"><code>hashtable</code></em>.  If the <em class="replaceable"><code>mutable</code></em> argument is
provided and is true, the returned hashtable is mutable; otherwise it is
immutable.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46668320"></a><code class="function">hashtable-clear!</code> <em class="replaceable"><code>hashtable</code></em></p>
<p class="synopsis"><a class="indexterm" name="idp46671024"></a><code class="function">hashtable-clear!</code> <em class="replaceable"><code>hashtable</code></em> <em class="replaceable"><code>k</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Remove all associations from <em class="replaceable"><code>hashtable</code></em> and returns unspecified
values.
</p>
<p>If a second argument is given, the current capacity of the hashtable is
reset to approximately <em class="replaceable"><code>k</code></em> elements.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46676448"></a><code class="function">hashtable-keys</code> <em class="replaceable"><code>hashtable</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return a vector of all keys in <em class="replaceable"><code>hashtable</code></em>.  The order of the vector
is unspecified.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46680528"></a><code class="function">hashtable-entries</code> <em class="replaceable"><code>hashtable</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Return two values, a vector of the keys in <em class="replaceable"><code>hashtable</code></em>, and a vector
of the corresponding values.
</p>
<p>Example:
</p>
<pre class="screen">(let ((h (make-eqv-hashtable)))
  (hashtable-set! h 1 'one)
  (hashtable-set! h 2 'two)
  (hashtable-set! h 3 'three)
  (hashtable-entries h))
⇒ #(1 2 3) #(one two three) ; two return values
</pre>
<p>the order of the entries in the result vectors is not known.
</p>
</blockquote></div>
</div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Inspection"></a>Inspection</h4></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46687504"></a><code class="function">hashtable-equivalence-function</code> <em class="replaceable"><code>hashtable</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return the equivalence function used by <em class="replaceable"><code>hashtable</code></em> to compare keys.
For hashtables created with <code class="literal">make-eq-hashtable</code> and
<code class="literal">make-eqv-hashtable</code>, returns <code class="literal">eq?</code> and <code class="literal">eqv?</code>
respectively.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46694544"></a><code class="function">hashtable-hash-function</code> <em class="replaceable"><code>hashtable</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return the hash function used by <em class="replaceable"><code>hashtable</code></em>.  For hashtables
created by <code class="literal">make-eq-hashtable</code> or <code class="literal">make-eqv-hashtable</code>,
<code class="literal">#f</code> is returned.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46700768"></a><code class="function">hashtable-mutable?</code> <em class="replaceable"><code>hashtable</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return <code class="literal">#t</code> if <em class="replaceable"><code>hashtable</code></em> is mutable, otherwise <code class="literal">#f</code>.
</p></blockquote></div>
</div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Hash-functions"></a>Hash functions</h4></div></div></div>
<p>The <code class="literal">equal-hash</code>, <code class="literal">string-hash</code>, and <code class="literal">string-ci-hash</code>
procedures of this section are acceptable as the hash functions of a
hashtable only if the keys on which they are called are not mutated
while they remain in use as keys in the hashtable.
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46710000"></a><code class="function">equal-hash</code> <em class="replaceable"><code>obj</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Return an integer hash value for <em class="replaceable"><code>obj</code></em>, based on its structure and
current contents.  This hash function is suitable for use with
<code class="literal">equal?</code> as an equivalence function.
</p>
<div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Note:</em></span> Like <code class="literal">equal?</code>, the <code class="literal">equal-hash</code> procedure must
always terminate, even if its arguments contain cycles.
</p></blockquote></div>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46717200"></a><code class="function">string-hash</code> <em class="replaceable"><code>string</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return an integer hash value for <em class="replaceable"><code>string</code></em>, based on its current
contents.  This hash function is suitable for use with <code class="literal">string=?</code>
as an equivalence function.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46722112"></a><code class="function">string-ci-hash</code> <em class="replaceable"><code>string</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return an integer hash value for <em class="replaceable"><code>string</code></em> based on its current
contents, ignoring case.  This hash function is suitable for use with
<code class="literal">string-ci=?</code> as an equivalence function.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46727040"></a><code class="function">symbol-hash</code> <em class="replaceable"><code>symbol</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Return an integer hash value for <em class="replaceable"><code>symbol</code></em>.
</p></blockquote></div>
</div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="SRFI-69-hash-tables"></a>SRFI-69 hash tables</h4></div></div></div>
<p>To use these hash table functions in your Kawa program you must first:
</p>
<pre class="screen">(require 'srfi-69)
</pre>
<p>or
</p>
<pre class="screen">(require 'hash-table)
</pre>
<p>or
</p>
<pre class="screen">(import (srfi :69 basic-hash-tables))
</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Type-constructors-and-predicate"></a>Type constructors and predicate</h4></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46736000"></a><code class="function">make-hash-table</code> [<em class="replaceable"><code> equal?</code></em> [<em class="replaceable"><code> hash</code></em> [<em class="replaceable"><code> size-hint</code></em>]]]<em class="replaceable"><code> →</code></em><em class="replaceable"><code> hash-table</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Create a new hash table with no associations.
The <em class="replaceable"><code>equal?</code></em> parameter is a predicate
that should accept two keys and return a boolean telling whether they
denote the same key value; it defaults to the <code class="literal">equal?</code> function.
</p>
<p>The <em class="replaceable"><code>hash</code></em> parameter is a hash function, and defaults to an
appropriate hash function
for the given <em class="replaceable"><code>equal?</code></em> predicate (see the Hashing section).
However, an
acceptable default is not guaranteed to be given for any equivalence
predicate coarser than <code class="literal">equal?</code>, except for <code class="literal">string-ci=?</code>.
(The function <code class="literal">hash</code> is acceptable for <code class="literal">equal?</code>, so if you
use coarser equivalence than <code class="literal">equal?</code> other than <code class="literal">string-ci=?</code>,
you must always provide the function hash yourself.)
(An equivalence predicate <em class="replaceable"><code>c1</code></em> is coarser than a equivalence
predicate <em class="replaceable"><code>c2</code></em> iff there exist values <em class="replaceable"><code>x</code></em> and <em class="replaceable"><code>y</code></em> such
that <code class="literal">(and (<em class="replaceable"><code>c1</code></em> <em class="replaceable"><code>x</code></em> <em class="replaceable"><code>y</code></em>) (not (<em class="replaceable"><code>c2</code></em> <em class="replaceable"><code>x</code></em> <em class="replaceable"><code>y</code></em>)))</code>.)
</p>
<p>The <em class="replaceable"><code>size-hint</code></em> parameter can be used to suggested an approriate
initial size.  This option is not part of the SRFI-69 specification
(though it is handled by the reference implementation), so specifying
that option might be unportable.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46754432"></a><code class="function">hash-table?</code><em class="replaceable"><code> obj</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> boolean</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>A predicate to test whether a given object <em class="replaceable"><code>obj</code></em> is a hash table.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46758976"></a><code class="function">alist-&gt;hash-table</code><em class="replaceable"><code> alist</code></em> [<em class="replaceable"><code> equal?</code></em> [<em class="replaceable"><code> hash</code></em> [<em class="replaceable"><code> size-hint</code></em>]]]<em class="replaceable"><code> →</code></em><em class="replaceable"><code> hash-table</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Takes an association list <em class="replaceable"><code>alist</code></em> and creates a hash table
<em class="replaceable"><code>hash-table</code></em> which maps the <code class="literal">car</code> of every element in
<em class="replaceable"><code>alist</code></em> to the <code class="literal">cdr</code> of corresponding elements in
<em class="replaceable"><code>alist</code></em>. The <em class="replaceable"><code>equal?</code></em>, <em class="replaceable"><code>hash</code></em>, and <em class="replaceable"><code>size-hint</code></em>
parameters are interpreted as in <code class="literal">make-hash-table</code>. If some key
occurs multiple times in <em class="replaceable"><code>alist</code></em>, the value in the first
association will take precedence over later ones. (Note: the choice of
using <code class="literal">cdr</code> (instead of <code class="literal">cadr</code>) for values tries to strike
balance between the two approaches: using <em class="replaceable"><code>cadr</code></em> would render this
procedure unusable for <code class="literal">cdr</code> alists, but not vice versa.)
</p></blockquote></div>
</div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Reflective-queries"></a>Reflective queries</h4></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46774160"></a><code class="function">hash-table-equivalence-function</code><em class="replaceable"><code> hash-table</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns the equivalence predicate used for keys of <em class="replaceable"><code>hash-table</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46778160"></a><code class="function">hash-table-hash-function</code><em class="replaceable"><code> hash-table</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns the hash function used for keys of <em class="replaceable"><code>hash-table</code></em>.
</p></blockquote></div>
</div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Dealing-with-single-elements"></a>Dealing with single elements</h4></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46783248"></a><code class="function">hash-table-ref</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> key</code></em> [<em class="replaceable"><code> thunk</code></em> ]<em class="replaceable"><code> →</code></em><em class="replaceable"><code> value</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>This procedure returns the value associated to <em class="replaceable"><code>key</code></em> in
<em class="replaceable"><code>hash-table</code></em>. If no value is associated to <em class="replaceable"><code>key</code></em> and
<em class="replaceable"><code>thunk</code></em> is given, it is called with no arguments and its value is
returned; if <em class="replaceable"><code>thunk</code></em> is not given, an error is signalled. Given a
good hash function, this operation should have an (amortised) complexity
of O(1) with respect to the number of associations in <em class="replaceable"><code>hash-table</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46791088"></a><code class="function">hash-table-ref/default</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> key</code></em><em class="replaceable"><code> default</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> value</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Evaluates to the same value as <code class="literal">(hash-table-ref <em class="replaceable"><code>hash-table</code></em>
<em class="replaceable"><code>key</code></em> (lambda () <em class="replaceable"><code>default</code></em>))</code>. Given a good hash function, this
operation should have an (amortised) complexity of O(1) with respect
to the number of associations in hash-table.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46797872"></a><code class="function">hash-table-set!</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> key</code></em><em class="replaceable"><code> value</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> void</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>This procedure sets the value associated to <em class="replaceable"><code>key</code></em> in
<em class="replaceable"><code>hash-table</code></em>. The previous association (if any) is removed. Given
a good hash function, this operation should have an (amortised)
complexity of O(1) with respect to the number of associations in
hash-table.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46803616"></a><code class="function">hash-table-delete!</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> key</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> void</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>This procedure removes any association to <em class="replaceable"><code>key</code></em> in
<em class="replaceable"><code>hash-table</code></em>. It is not an error if no association for the
<em class="replaceable"><code>key</code></em> exists; in this case, nothing is done. Given a good hash
function, this operation should have an (amortised) complexity of O(1)
with respect to the number of associations in hash-table.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46809520"></a><code class="function">hash-table-exists?</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> key</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> boolean</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>This predicate tells whether there is any association to <em class="replaceable"><code>key</code></em> in
<em class="replaceable"><code>hash-table</code></em>. Given a good hash function, this operation should
have an (amortised) complexity of O(1) with respect to the number of
associations in hash-table.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46814944"></a><code class="function">hash-table-update!</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> key</code></em><em class="replaceable"><code> function</code></em> [<em class="replaceable"><code> thunk</code></em> ]<em class="replaceable"><code> →</code></em><em class="replaceable"><code> void</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Semantically equivalent to, but may be implemented more efficiently than,
the following code:
</p>
<pre class="screen">(hash-table-set! <em class="replaceable"><code>hash-table key</code></em>
                 (function (hash-table-ref <em class="replaceable"><code>hash-table</code></em> <em class="replaceable"><code>key</code></em> <em class="replaceable"><code>thunk</code></em>)))
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46822528"></a><code class="function">hash-table-update!/default</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> key</code></em><em class="replaceable"><code> function</code></em><em class="replaceable"><code> default</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> void</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Behaves as if it evaluates to
<code class="literal">(hash-table-update! <em class="replaceable"><code>hash-table</code></em> <em class="replaceable"><code>key</code></em> <em class="replaceable"><code>function</code></em> (lambda () <em class="replaceable"><code>default</code></em>))</code>.
</p></blockquote></div>
</div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Dealing-with-the-whole-contents"></a>Dealing with the whole contents</h4></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46830976"></a><code class="function">hash-table-size</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> integer</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns the number of associations in <em class="replaceable"><code>hash-table</code></em>. This operation takes
constant time.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46835552"></a><code class="function">hash-table-keys</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> list</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a list of keys in <em class="replaceable"><code>hash-table</code></em>.
The order of the keys is unspecified.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46840144"></a><code class="function">hash-table-values</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> list</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a list of values in <em class="replaceable"><code>hash-table</code></em>. The order of the values is
unspecified, and is not guaranteed to match the order of keys in the
result of <code class="literal">hash-table-keys</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46845488"></a><code class="function">hash-table-walk</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> proc</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> void</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p><em class="replaceable"><code>proc</code></em> should be a function taking two arguments, a key and a
value. This procedure calls <em class="replaceable"><code>proc</code></em> for each association in
<em class="replaceable"><code>hash-table</code></em>, giving the key of the association as key and the
value of the association as value. The results of <em class="replaceable"><code>proc</code></em> are
discarded. The order in which <em class="replaceable"><code>proc</code></em> is called for the different
associations is unspecified.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46852176"></a><code class="function">hash-table-fold</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> f</code></em><em class="replaceable"><code> init-value</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> final-value</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>This procedure calls <em class="replaceable"><code>f</code></em> for every association in <em class="replaceable"><code>hash-table</code></em>
with three arguments: the key of the association key, the value of the
association value, and an accumulated value, <em class="replaceable"><code>val</code></em>. The <em class="replaceable"><code>val</code></em>
is <em class="replaceable"><code>init-value</code></em> for the first invocation of <em class="replaceable"><code>f</code></em>, and for
subsequent invocations of <em class="replaceable"><code>f</code></em>, the return value of the previous
invocation of <em class="replaceable"><code>f</code></em>. The value <em class="replaceable"><code>final-value</code></em> returned by
<code class="literal">hash-table-fold</code> is the return value of the last invocation of
<em class="replaceable"><code>f</code></em>. The order in which <em class="replaceable"><code>f</code></em> is called for different
associations is unspecified.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46862496"></a><code class="function">hash-table-&gt;alist</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> alist</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns an association list such that the <code class="literal">car</code> of each element
in <em class="replaceable"><code>alist</code></em> is a key in <em class="replaceable"><code>hash-table</code></em> and the corresponding
<code class="literal">cdr</code> of each element in <em class="replaceable"><code>alist</code></em> is the value associated to
the key in <em class="replaceable"><code>hash-table</code></em>. The order of the elements is unspecified.
</p>
<p>The following should always produce a hash table with the same mappings
as a hash table <em class="replaceable"><code>h</code></em>:
</p>
<pre class="screen">(alist-&gt;hash-table (hash-table-&gt;alist <em class="replaceable"><code>h</code></em>)
                        (hash-table-equivalence-function <em class="replaceable"><code>h</code></em>)
                        (hash-table-hash-function <em class="replaceable"><code>h</code></em>))
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46872672"></a><code class="function">hash-table-copy</code><em class="replaceable"><code> hash-table</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> hash-table</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a new hash table with the same equivalence predicate, hash
function and mappings as in <em class="replaceable"><code>hash-table</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46877264"></a><code class="function">hash-table-merge!</code><em class="replaceable"><code> hash-table1</code></em><em class="replaceable"><code> hash-table2</code></em><em class="replaceable"><code> →</code></em><em class="replaceable"><code> hash-table</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Adds all mappings in <em class="replaceable"><code>hash-table2</code></em> into <em class="replaceable"><code>hash-table1</code></em> and
returns the resulting hash table. This function may modify
<em class="replaceable"><code>hash-table1</code></em> destructively.
</p></blockquote></div>
</div>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Hash-functions"></a>Hash functions</h4></div></div></div>
<p>The Kawa implementation always calls these hash functions with a single
parameter, and expects the result to be within the entire
(32-bit signed) <code class="literal">int</code> range, for compatibility with
standard <code class="literal">hashCode</code> methods.
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46886096"></a><code class="function">hash</code><em class="replaceable"><code> object</code></em> [<em class="replaceable"><code> bound</code></em> ]<em class="replaceable"><code> →</code></em><em class="replaceable"><code> integer</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Produces a hash value for object in the range from 0 (inclusive) tp to
<em class="replaceable"><code>bound</code></em> (exclusive).
</p>
<p>If <em class="replaceable"><code>bound</code></em> is not given, the Kawa implementation returns a value within
the range <code class="literal">(- (expt 2 32))</code> (inclusive)
to <code class="literal">(- (expt 2 32) 1)</code> (inclusive).
It does this by calling the standard <code class="literal">hashCode</code> method,
and returning the result as is.
(If the <em class="replaceable"><code>object</code></em> is the Java <code class="literal">null</code> value, 0 is returned.)
This hash function is acceptable for <code class="literal">equal?</code>.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46896576"></a><code class="function">string-hash</code><em class="replaceable"><code> string</code></em> [<em class="replaceable"><code> bound</code></em> ]<em class="replaceable"><code> →</code></em><em class="replaceable"><code> integer</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>The same as <code class="literal">hash</code>, except that the argument string must be a string.
(The Kawa implementation returns the same as the <code class="literal">hash</code> function.)
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46902736"></a><code class="function">string-ci-hash</code><em class="replaceable"><code> string</code></em> [<em class="replaceable"><code> bound</code></em> ]<em class="replaceable"><code> →</code></em><em class="replaceable"><code> integer</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>The same as <code class="literal">string-hash</code>, except that the case of characters in
string does not affect the hash value produced.
(The Kawa implementation returns the same the <code class="literal">hash</code> function
applied to the lower-cased <em class="replaceable"><code>string</code></em>.)
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp46909360"></a><code class="function">hash-by-identity</code><em class="replaceable"><code> object</code></em> [<em class="replaceable"><code> bound</code></em> ]<em class="replaceable"><code> →</code></em><em class="replaceable"><code> integer</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>The same as <code class="literal">hash</code>, except that this function is only guaranteed
to be acceptable for <code class="literal">eq?</code>.
Kawa uses the <code class="literal">identityHashCode</code> method of <code class="literal">java.lang.System</code>.
</p></blockquote></div>
</div>
</div>
</div>
</div>
<div class="navfooter">
<ul>
<li><b class="toc"><a href="Data-structures.html#Sequences">Sequences</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Lists">Lists</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Vectors">Vectors</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Uniform-vectors">Uniform vectors</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Bytevectors">Bytevectors</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Streams">Streams - lazy lists</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Arrays">Multi-dimensional Arrays</a></b></li>
<li><b class="toc"><a href="Data-structures.html#Hash-tables">Hash tables</a></b></li>
</ul>
<p>
          Up: <a accesskey="u" href="Documentation.html">Documentation</a></p>
<p>
        Previous: <a accesskey="p" href="Characters-and-text.html">Characters and text</a></p>
<p>
        Next: <a accesskey="n" href="Eval-and-Environments.html">Eval and Environments</a></p>
</div>
</body>
</html>
