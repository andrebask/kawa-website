<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Kawa: Installing and using the source distribution</title>
<link rel="stylesheet" title="Kawa (navbar: fixed, left)" href="style/kawa-l.css" media="screen, print, projection, tv">
<link rel="alternate stylesheet" title="Kawa (navbar: fixed, right)" href="style/kawa-r.css" media="screen, print, projection, tv">
<link rel="alternate stylesheet" title="Single column, top navigation" href="style/kawa-1col.css" type="text/css" media="handheld, screen, print, projection, tv">

<link rel="home" href="toc.html" title="Kawa: The Kawa Scheme language">
<link rel="up" href="Installation.html" title="Kawa: Getting and installing Kawa">
<link rel="prev" href="Binary-distribution.html" title="Kawa: Installing and using the binary distribution">
<link rel="next" href="Features.html" title="Kawa: Features">
<link rel="stylesheet" href="../kawa.css" type="text/css" media="all">
<link rel="stylesheet" href="../kawa-layout.css" type="text/css" media="all">
</head>


<div class="header">
    <a href="index.html"><img class="logo" src="kawa-logo.png"/></a>
    <h1><a href="index.html">The Kawa Scheme Language</a></h1>
</div>

<body>
<div class="header">
    <a href="index.html"><img class="logo" src="kawa-logo.png"/></a>
    <h1><a href="index.html">The Kawa Scheme Language</a></h1>
</div>
<div class="content">
<div class="navcol">

<div class="navbar">
<ul>
<li><a href="toc.html">Table of Contents</a></li>
<li><a href="tutorial/index.html">Tutorial</a></li>
<li><a href="news.html">News: Recent changes</a></li>
</ul>
<div class="toc"><ul>
<li><a href="index.html">The Kawa Scheme language</a></li>
<li>
<a href="Installation.html">Getting and installing Kawa</a><ul>
<li><a href="Getting-Kawa.html">Getting Kawa</a></li>
<li><a href="Running-Java.html">Getting and running Java</a></li>
<li><a href="Binary-distribution.html">Installing and using the binary distribution</a></li>
<li>
<b class="toc"><a href="Source-distribution.html">Installing and using the source distribution</a></b><ul>
<li><b class="toc"><a href="Source-distribution.html#Build-Kawa-using-configure-and-make">Build Kawa using <code class="literal">configure</code> and <code class="literal">make</code></a></b></li>
<li><b class="toc"><a href="Source-distribution.html#Build-Kawa-using-ant">Build Kawa using <code class="literal">ant</code></a></b></li>
<li><b class="toc"><a href="Source-distribution.html#Compiling-Kawa-to-native-code-with-GCJ">Compiling Kawa to native code with GCJ</a></b></li>
<li><b class="toc"><a href="Source-distribution.html#Building-Kawa-under-MS-Windows">Building Kawa under MS-Windows</a></b></li>
</ul>
</li>
</ul>
</li>
<li><a href="Features.html">Features</a></li>
<li><a href="Documentation.html">Documentation</a></li>
<li><a href="Development.html">Development</a></li>
<li><a href="Community.html">The Kawa Community</a></li>
<li><a href="About.html">About</a></li>
<li><a href="Overall-Index.html">Index</a></li>
</ul></div>
</div>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="Source-distribution"></a>Installing and using the source distribution</h2></div></div></div>
<p>The Kawa release normally comes as a gzip-compressed tar file named
‘<code class="literal">kawa-1.14.1.tar.gz</code>’.


Two methods are supporting for compiling the Kawa sources;
choose whichever is most convenient for you.
</p>
<p>One method uses the traditional GNU <code class="literal">configure</code> script,
followed by running <code class="literal">make</code>.  This works well on Unix-like
systems, such as GNU/Linux.
You can also use this method on Microsoft Windows,
as long as use <a class="ulink" href="http://www.cygwin.org/.%20Cygwin" target="_top">http://www.cygwin.org/. Cygwin</a>.
</p>
<p>The other method uses the <code class="literal">ant</code> command, a Java-based
build system released by Apache's Jakarta project.  This uses
an <code class="literal">build.xml</code> file in place of <code class="literal">Makefile</code>s, and
works on non-Unix systems such as Microsoft Windows.  However,
the <code class="literal">ant</code> method does not support all
the features of the <code class="literal">configure</code>+<code class="literal">make</code> method.
</p>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Build-Kawa-using-configure-and-make"></a>Build Kawa using <code class="literal">configure</code> and <code class="literal">make</code>
</h3></div></div></div>
<p>In your build directory do:
</p>
<pre class="screen">tar xzf kawa-1.14.1.tar.gz
cd kawa-1.14.1
</pre>
<p>Then you must configure the sources.  This you can do
the same way you configure most other GNU software.  Normally
you can just run the configure script with no arguments:
</p>
<pre class="screen">./configure
</pre>
<p>This will specify that a later <code class="literal">make install</code> will install the
compiled ‘<code class="literal">.class</code>’ files into <code class="literal">/usr/local/share/java</code>.
If you want them
to be installed someplace else, such as <code class="literal">$PREFIX/share/java</code>, then
specify that when you run configure:
</p>
<pre class="screen">./configure --prefix $PREFIX
</pre>
<p>If you have the GNU ‘<code class="literal">readline</code>’ library installed, you might try
adding the ‘<code class="literal">--enable-kawa-frontend</code>’ flag.  This will build the
‘<code class="literal">kawa</code>’ front-end program, which provides input-line editing
and an input history.  You can get ‘<code class="literal">readline</code>’ from archives
of GNU programs, including <a class="ulink" href="ftp://www.gnu.org/" target="_top">ftp://www.gnu.org/</a>.
</p>
<p>If you have Swing installed, and want to use JEmacs (Emacs in Java),
also pass the <code class="literal">--with-swing</code> flag to <code class="literal">configure</code>.
</p>
<p>If you have installed Kawa before, make sure your <code class="literal">CLASSPATH</code>
does not include old versions of Kawa, or other classes that may
conflict with the new ones.
</p>
<p>As distributed, the Kawa source code requires Java 7.
If you only have Java 6 or Java 5, use the <code class="literal">--with-have-source</code> option:
</p>
<pre class="screen">./configure --with-java-source=5
</pre>
<p>Kawa no longer supports older verisons of Java (JDK 1.4 or older).
It might be possible to use a tool
like <a class="ulink" href="http://retroweaver.sourceforge.net/" target="_top">Retroweaver</a>
on the Kawa <code class="literal">.jar</code> to fix up Java 5 dependencies.
Contact the Kawa author if you want to be a tester for this.
</p>
<p>Then you need to compile all the .java source files.
Just run make:
</p>
<pre class="screen">make
</pre>
<p>This assumes that ‘<code class="literal">java</code>’ and ‘<code class="literal">javac</code>’ are the java interpreter
and compiler, respectively.
For example, if you are using the Kaffe Java interpreter,
you need to instead say:
</p>
<pre class="screen">make JAVA=kaffe
</pre>
<p>It has been reported that parallel make doesn't work,
so don't use the <code class="literal">-j2</code> or above options.
</p>
<p>If you configured with <code class="literal">--enable-kawa-frontend</code>, you
may need to specify <code class="literal">READLINE_INCLUDE_PATH</code> or <code class="literal">READINE_LIB_PATH</code>.
For example on OS/X you need to do:
</p>
<pre class="screen">make READLINE_INCLUDE_PATH=-I/usr/local/unix/readline/include \
     READLINE_LIB_PATH=-L/usr/local/unix/readline/lib
</pre>
<p>You can now test the system by running Kawa in place:
</p>
<pre class="screen">java kawa.repl
</pre>
<p>or you can run the test suite:
</p>
<pre class="screen">make check
</pre>
<p>or you can install the compiled files:
</p>
<pre class="screen">make install
</pre>
<p>This will install your classes into <code class="literal">$PREFIX/share/java</code> (and its
sub-directories).  Here <code class="literal">$PREFIX</code> is the directory you specified
to configure with the <code class="literal">--prefix</code> option, or <code class="literal">/usr/local</code> if you
did not specify a <code class="literal">--prefix</code> option.
</p>
<p>To use the installed files, you need to set <code class="literal">CLASSPATH</code> so
that <code class="literal">$PREFIX/share/java/kawa.jar</code> is in the path:
</p>
<pre class="screen">CLASSPATH=$PREFIX/share/java/kawa.jar
export CLASSPATH
</pre>
<p>This is done automatically if you use the ‘<code class="literal">kawa</code>’ script.
</p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Build-Kawa-using-ant"></a>Build Kawa using <code class="literal">ant</code>
</h3></div></div></div>
<p>Kawa now includes an Ant buildfile (<code class="literal">build.xml</code>).
<a class="ulink" href="http://ant.apache.org" target="_top">Ant</a> is a part of the Apache
Jakarta project.
If you don't hava Ant installed,
get it from <a class="ulink" href="http://ant.apache.org/bindownload.cgi" target="_top">http://ant.apache.org/bindownload.cgi</a>.
The build is entirely Java based and works equally well on *nix, Windows,
and presumably most any other operating system.
</p>
<p>Once Ant has been installed and configured (you may need to set the
<code class="literal">JAVA_HOME</code>, and <code class="literal">ANT_HOME</code> environment variables), you should
be able to change to the directory containing the <code class="literal">build.xml</code> file,
and invoke the ‘<code class="literal">ant</code>’ command.  With the default settings, a
successful build will result in a <code class="literal">kawa-1.14.1.jar</code> in the
current directory.
</p>
<p>There are a few Ant "targets" of interest (they can be supplied on the
Ant command line):
</p>
<div class="variablelist"><dl class="variablelist">
<dt class="term"><code class="literal">all</code></dt>
<dd><p>This is the default, it does <code class="literal">classes</code> and <code class="literal">jar</code>.
</p></dd>
<dt class="term"><code class="literal">classes</code></dt>
<dd><p>Compiles all the files into <code class="literal">*.class</code> files into the directory
specified by the <code class="literal">build.dir</code> property.
</p></dd>
<dt class="term"><code class="literal">jar</code></dt>
<dd><p>Builds a jar into into the directory
specified by the <code class="literal">dist.dir</code> property.
</p></dd>
<dt class="term"><code class="literal">runw</code></dt>
<dd><p>Run Kawa in a GUI window.
</p></dd>
<dt class="term"><code class="literal">clean</code></dt>
<dd><p>Deletes all files generated by the build, including the jar.
</p></dd>
</dl></div>
<p>There is not yet a <code class="literal">test</code> target for running the testsuite.
</p>
<p>The are various "properties" that control what <code class="literal">ant</code> does.  You can
override the on the command line or by editing the
<code class="literal">build.properties</code> file in the same directory as <code class="literal">build.xml</code>.
For example the <code class="literal">build.dir</code> directory tells <code class="literal">ant</code> where to
build temporary files, and where to leave the resulting <code class="literal">.jar</code>
file.  For example, to leave the generated files in the sub-directory
named <code class="literal">BUILD</code> do:
</p>
<pre class="screen">ant -Dbuild.dir=BUILD
</pre>
<p>A sample <code class="literal">build.properties</code> is provided and it contains
comments explaining many of the options.
</p>
<p>Here are a few general properties that help to customize your build:
</p>
<div class="variablelist"><dl class="variablelist">
<dt class="term"><code class="literal">build.dir</code></dt>
<dd><p>Path to put the temporary files used for building.
</p></dd>
<dt class="term"><code class="literal">dist.dir</code></dt>
<dd><p>Path to put the resulting jar file.
</p></dd>
<dt class="term"><code class="literal">version.local</code></dt>
<dd><p>A suffix to add to the version label for your customized version.
</p></dd>
<dt class="term"><code class="literal">debug</code></dt>
<dd><p>Whether (true/false) the Javac "-g" option is enabled.
</p></dd>
<dt class="term"><code class="literal">optimize</code></dt>
<dd><p>Whether (true/false) the Javac "-O" option is enabled.
</p></dd>
</dl></div>
<p>Here are some Kawa-specific ones (all <code class="literal">true</code>/<code class="literal">false</code>):
<code class="literal">with-collections</code>, <code class="literal">with-references</code>, <code class="literal">with-awt</code>,
<code class="literal">with-swing</code>, <code class="literal">enable-jemacs</code>, and <code class="literal">enable-servlet</code>&gt;
See the sample <code class="literal">build.properties</code> for more information on these.
</p>
<p>If you change any of the build properties, you will generally want to do
an ‘<code class="literal">ant clean</code>’ before building again as the build is often not able to
notice that kind of change.  In the case of changing a directory path,
you would want to do the <code class="literal">clean</code> before changing the path.
</p>
<p>A special note for NetBeans users:
For some reason the build-tools target which compiles an Ant task won't
compile with the classpath provided by NetBeans.
You may do ‘<code class="literal">ant build-tools</code>’ from the command line outside of NetBeans,
in which case you will not want to use the <code class="literal">clean</code> target as that
will delete the tool files as well.
You can use the <code class="literal">clean-build</code> and/or <code class="literal">clean-dist</code>
targets as appropriate.  Alternatively you can add <code class="literal">ant.jar</code> to the
<code class="literal">build-tools</code> classpath by copying or linking it into a <code class="literal">lib/ext</code>
directory in Kawa's source directory (the one containing the <code class="literal">build.xml</code>
file).
</p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Compiling-Kawa-to-native-code-with-GCJ"></a>Compiling Kawa to native code with GCJ</h3></div></div></div>
<p>The GNU Compiler for the Java(tm) Programming Language
(<a class="ulink" href="http://gcc.gnu.org/java/" target="_top">GCJ</a>) is part of the
GNU Compiler Collection (<a class="ulink" href="http://gcc.gnu.org/" target="_top">GCC</a>).
It can compile Java source or bytecode
files into native code on supported systems.
Version 4.1 or later of GCC is recommended,
and only Intel x86-based Linux/GNU system have been tested with Kawa.
</p>
<p>First, get and install GCC.  Set <code class="literal">PREFIX</code> to where
you want to install GCJ, and configure it with these options:
</p>
<pre class="screen">./configure --enable-threads --enable-languages=c++,java --prefix $PREFIX
make bootstrap
make install
</pre>
<p>Make sure <code class="literal">gcj</code> is in your path and refers to the newly-installed
version, and if needed, set <code class="literal">LD_LIBRARY_PATH</code> to point to the
directory where <code class="literal">libgcj.so</code> was installed:
</p>
<pre class="screen">PATH=$PREFIX/bin:$PATH
LD_LIBRARY_PATH=$PREFIX/lib
export LD_LIBRARY_PATH
</pre>
<p>To build Kawa, you need to specify <code class="literal">--with-gcj</code> to
<code class="literal">configure</code> which tells it to use GCJ.
</p>
<pre class="screen">./configure --with-gcj --prefix $PREFIX
</pre>
<p>Then as before:
</p>
<pre class="screen">make
make install
</pre>
<p>Alternatively, you can use configure option
<code class="literal">--with-gcj-dbtool</code>.  This allows gcj to automatically
find the kawa shared libraries from the <code class="literal">.jar</code> file.
</p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Building-Kawa-under-MS-Windows"></a>Building Kawa under MS-Windows</h3></div></div></div>
<p>Using the <code class="literal">ant</code> method is recommended for building
Kawa under Microsoft Windows.
You may get an error message "<code class="literal">Out of environment space</code>."
See <a class="ulink" href="http://support.microsoft.com/support/kb/articles/Q230/2/05.ASP" target="_top">http://support.microsoft.com/support/kb/articles/Q230/2/05.ASP</a>
for a solution.  Alternatively you can run
the class <code class="literal">org.apache.tools.ant.Main</code> directly from the Ant jar.
</p>
<p>The Kawa <code class="literal">configure</code> and <code class="literal">make</code> process assumes a Unix-like
environment.  The free <a class="ulink" href="http://sourceware.org/cygwin/" target="_top">Cygwin</a>
environment can be used for building Kawa: The Kawa configure script
recognizes Cygwin, and modifies the classpath to use Windows-style
path separators.  (At the time of writing there were still some
path issues with running the testsuite.)
</p>
<p><a class="ulink" href="http://www.mingw.org/" target="_top">MinGW</a> may also work but has not been tested.
</p>
</div>
</div>
<div class="navfooter">
<ul>
<li><b class="toc"><a href="Source-distribution.html#Build-Kawa-using-configure-and-make">Build Kawa using <code class="literal">configure</code> and <code class="literal">make</code></a></b></li>
<li><b class="toc"><a href="Source-distribution.html#Build-Kawa-using-ant">Build Kawa using <code class="literal">ant</code></a></b></li>
<li><b class="toc"><a href="Source-distribution.html#Compiling-Kawa-to-native-code-with-GCJ">Compiling Kawa to native code with GCJ</a></b></li>
<li><b class="toc"><a href="Source-distribution.html#Building-Kawa-under-MS-Windows">Building Kawa under MS-Windows</a></b></li>
</ul>
<p>
          Up: <a accesskey="u" href="Installation.html">Getting and installing Kawa</a></p>
<p>
        Previous: <a accesskey="p" href="Binary-distribution.html">Installing and using the binary distribution</a></p>
</div>
</div>
 </body>
</html>
