<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Kawa: Miscellaneous topics</title>
<link rel="stylesheet" title="Kawa (navbar: fixed, left)" href="style/kawa-l.css" media="screen, print, projection, tv">
<link rel="alternate stylesheet" title="Kawa (navbar: fixed, right)" href="style/kawa-r.css" media="screen, print, projection, tv">
<link rel="alternate stylesheet" title="Single column, top navigation" href="style/kawa-1col.css" type="text/css" media="handheld, screen, print, projection, tv">

<link rel="home" href="toc.html" title="Kawa: The Kawa Scheme language">
<link rel="up" href="Documentation.html" title="Kawa: Documentation">
<link rel="prev" href="XML-tools.html" title="Kawa: Working with XML and HTML">
<link rel="next" href="Development.html" title="Kawa: Development">
<link rel="stylesheet" href="../kawa.css" type="text/css" media="all">
<link rel="stylesheet" href="../kawa-layout.css" type="text/css" media="all">
</head>


<div class="header">
    <a href="index.html"><img class="logo" src="kawa-logo.png"/></a>
    <h1><a href="index.html">The Kawa Scheme Language</a></h1>
</div>

<body>
<div class="header">
    <a href="index.html"><img class="logo" src="kawa-logo.png"/></a>
    <h1><a href="index.html">The Kawa Scheme Language</a></h1>
</div>
<div class="content">
<div class="navcol">

<div class="navbar">
<ul>
<li><a href="toc.html">Table of Contents</a></li>
<li><a href="tutorial/index.html">Tutorial</a></li>
<li><a href="news.html">News: Recent changes</a></li>
</ul>
<div class="toc"><ul>
<li><a href="index.html">The Kawa Scheme language</a></li>
<li><a href="Installation.html">Getting and installing Kawa</a></li>
<li><a href="Features.html">Features</a></li>
<li>
<a href="Documentation.html">Documentation</a><ul>
<li><a href="Running.html">Usage Reference</a></li>
<li><a href="Syntax.html">Syntax</a></li>
<li><a href="Program-structure.html">Program structure</a></li>
<li><a href="Multiple-values.html">Multiple values</a></li>
<li><a href="Symbols-and-namespaces.html">Symbols and namespaces</a></li>
<li><a href="Procedures.html">Procedures</a></li>
<li><a href="Numbers.html">Numbers</a></li>
<li><a href="Characters-and-text.html">Characters and text</a></li>
<li><a href="Data-structures.html">Data structures</a></li>
<li><a href="Eval-and-Environments.html">Eval and Environments</a></li>
<li><a href="Debugging.html">Debugging</a></li>
<li><a href="Input-Output.html">Input, output, files</a></li>
<li><a href="Types.html">Types</a></li>
<li><a href="Objects-Classes-and-Modules.html">Object, Classes and Modules</a></li>
<li><a href="XML-tools.html">Working with XML and HTML</a></li>
<li>
<b class="toc"><a href="Miscellaneous.html">Miscellaneous topics</a></b><ul>
<li><b class="toc"><a href="Miscellaneous.html#Building-JavaFX-applications">Building JavaFX applications</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Building-for-Android">Building for Android</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Android-view-construction">Android view construction</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#System-inquiry">System inquiry</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Processes">Processes</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Time-related-functions">Time-related functions</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Low-level-functions">Deprecated low-level functions</a></b></li>
</ul>
</li>
</ul>
</li>
<li><a href="Development.html">Development</a></li>
<li><a href="Community.html">The Kawa Community</a></li>
<li><a href="About.html">About</a></li>
<li><a href="Overall-Index.html">Index</a></li>
</ul></div>
</div>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="Miscellaneous"></a>Miscellaneous topics</h2></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50181904"></a><code class="function">scheme-implementation-version</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns the Kawa version number as a string.

</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50185552"></a><code class="function">scheme-window</code> [<em class="replaceable"><code>shared</code></em>]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>Create a read-eval-print-loop in a new top-level window.
If <em class="replaceable"><code>shared</code></em> is true, it uses the same environment as the
current <code class="literal">(interaction-environment)</code>;  if not (the default),
a new top-level environment is created.
</p>
<p>You can create multiple top-level window that can co-exist.
They run in separate threads.
</p>
</blockquote></div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Building-JavaFX-applications"></a>Building JavaFX applications</h3></div></div></div>
<a class="indexterm" name="idp50191376"></a><p>Kawa makes it easy to build “rich client” (i.e. GUI) applications using
<a class="ulink" href="http://www.oracle.com/technetwork/java/javafx/overview/index.html" target="_top">JavaFX</a>.
For example the following program will print up a window with a button;
clicking on the button will print a message on the console output about the
event.
</p>
<pre class="screen">(require 'javafx-defs)
(javafx-application)

(javafx-scene
 title: "Hello Button"
 width: 600 height: 450
 (Button
  text: "Click Me"
  layout-x: 25
  layout-y: 40
  on-action: (lambda (e) (format #t "Event: ~s~%~!" e))))
</pre>
<p>JavaFX support is builtin to the pre-built <code class="literal">kawa-1.14.1.jar</code>.
It is easiest to use JDK 8; see below if you're using JDK 7.
If you build Kawa from source, specify <code class="literal">--with-javafx</code> on the
<code class="literal">configure</code> command line (assuming you're using JDK 8).
</p>
<p>Assume the above file is <code class="literal">HelloButton1.scm</code>, you can
run it like this:
</p>
<pre class="screen">$ kawa HelloButton1.scm
</pre>
<p>For more information and examples read this (slightly older)
<a class="ulink" href="http://per.bothner.com/blog/2011/JavaFX-using-Kawa-intro/" target="_top">introduction</a>,
and
<a class="ulink" href="http://localhost/per/blog/2011/JavaFX-using-Kawa-animation/" target="_top">this on animation</a>.
</p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Using-JavaFX-with-JDK-7"></a>Using JavaFX with JDK 7</h4></div></div></div>
<p>JDK 8 ships with JavaFX, and it is in the default <code class="literal">CLASSPATH</code>.
JDK 7 update 9 or later does have JavaFX included, but it is a separate
<code class="literal">jfxrt.jar</code> which not in the default <code class="literal">CLASSPATH</code>.
Thus have have to eplicitly add <code class="literal">jfxrt.jar</code>.
To run the previous <code class="literal">HelloButton1.scm</code> you can do:
</p>
<pre class="screen">java -cp $JAVA_HOME/lib/jfxrt.jar:$KAWA_HOME/kawa.jar HelloButton1.scm
</pre>
<p>If you build Kawa from source, do:
</p>
<pre class="screen">$ ./configure --with-javafx=$JAVA_HOME --enable-kawa-frontend ...other-args...
</pre>
<p>The resulting Kawa binary sets up the path to <code class="literal">jfxrt.jar</code> so you just need to do:
</p>
<pre class="screen">$ kawa HelloButton1.scm
</pre>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Building-for-Android"></a>Building for Android</h3></div></div></div>
<p>Google's phone/tablet operating system
<a class="ulink" href="https://developers.google.com/android/" target="_top">Android</a>
is based on a custom virtual machine on top of a Linux kernel.
Even though Android isn't strictly (or legally) speaking Java,
you can build Android applications using Kawa.
</p>
<p>Below is "Hello world" written in Kawa Scheme.  A slightly
more interesting example is in <a class="link" href="Miscellaneous.html#Android-view-construction" title="Kawa: Android view construction">next section</a>.
</p>
<pre class="screen">(require 'android-defs)
(activity hello
  (on-create-view
   (android.widget.TextView (this)
    text: "Hello, Android from Kawa Scheme!")))
</pre>
<p>The following instructions have been tested on GNU/Linux,
specifically Fedora 17.
<a class="ulink" href="http://asieno.com/blog/index.php/post/2012/08/16/Setting-up-the-environment-Android-Kawa" target="_top">This link</a> may be helpful if you're building on Windows.
</p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Downloading-and-setting-up-the-Android-SDK"></a>Downloading and setting up the Android SDK</h4></div></div></div>
<p>First <a class="ulink" href="http://code.google.com/android/download.html" target="_top">download the Android SDK</a>. Unzip in a suitable location, which we'll refer to as <code class="literal">ANDROID_HOME</code>.
</p>
<pre class="screen">export ANDROID_HOME=/path/to/android-sdk-linux
PATH=$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools:$PATH
</pre>
<p>Next you have to get the appropriate platform SDK:
</p>
<pre class="screen">$ android update sdk
</pre>
<p>You need to select an Android “platform”.
Platform (API) 16 corresponds to Android 4.1.2 (Jelly Bean).
Select that or whatever you prefer, and click <code class="literal">Install</code>.
(You can install multiple platforms, but each project
is built for a specific platform.)
</p>
<pre class="screen">ANDROID_PLATFORM=android-16
</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Building-Kawa-for-Android"></a>Building Kawa for Android</h4></div></div></div>
<p>Set <code class="literal">JAVA_HOME</code> to where your JDK tree is.
You should use JDK 6; JDK 7 does not work at time of writing.
</p>
<pre class="screen">$ export JAVA_HOME=/opt/jdk1.6
</pre>
<p>First <a class="link" href="Getting-Kawa.html" title="Kawa: Getting Kawa">get the Kawa source code</a>.
</p>
<p>If using Ant (as is recommended on Windows):
</p>
<pre class="screen">$ ant -Denable-android=true
</pre>
<p>Alternatively, you can use <code class="literal">configure</code> and <code class="literal">make</code>:
</p>
<pre class="screen">$ KAWA_DIR=path_to_Kawa_sources
$ cd $KAWA_DIR
$ ./configure --with-android=$ANDROID_HOME/platforms/$ANDROID_PLATFORM/android.jar --disable-xquery --disable-jemacs
$ make
</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Creating-the-application"></a>Creating the application</h4></div></div></div>
<p>Next, we need to create a project or “activity”.
This tutorial assumes you want to create the project
in the target directory <code class="literal">KawaHello</code>,
with the main activity being a class named <code class="literal">hello</code> in a
package <code class="literal">kawa.android</code>:
</p>
<pre class="screen">PROJECT_DIR=KawaHello
PROJECT_CLASS=hello
PROJECT_PACKAGE=kawa.android
PROJECT_PACKAGE_PATH=kawa/android
</pre>
<p>To create the project use the following command:
</p>
<pre class="screen">$ android create project --target $ANDROID_PLATFORM --name $PROJECT_DIR --activity $PROJECT_CLASS --path ./$PROJECT_DIR --package $PROJECT_PACKAGE
</pre>
<p>Replace the skeleton <code class="literal">hello.java</code> by the Scheme code at the
top of this note, placing in a file named <code class="literal">hello.scm</code>:
</p>
<pre class="screen">$ cd $PROJECT_DIR
$ HELLO_APP_DIR=`pwd`
$ cd $HELLO_APP_DIR/src/$PROJECT_PACKAGE_PATH
$ rm $PROJECT_CLASS.java
$ <em class="wordasword">create</em> $PROJECT_CLASS.scm
</pre>
<p>We need to copy/link the Kawa jar file so the Android SDK can find it:
</p>
<pre class="screen">$ cd $HELLO_APP_DIR
$ ln -s $KAWA_DIR/kawa-1.14.1.jar libs/kawa.jar
</pre>
<p>Optionally, you can use kawart-1.14.1.jar, which is slightly smaller,
but does not support eval, and does not get built by the Ant build:
</p>
<pre class="screen">$ ln -s $KAWA_DIR/kawart-1.14.1.jar libs/kawa.jar
</pre>
<p>Copy or link <code class="literal">custom_rules.xml</code> from the Kawa sources:
</p>
<pre class="screen">ln -s $KAWA_DIR/gnu/kawa/android/custom_rules.xml .
</pre>
<p>Finally to build the application just do:
</p>
<pre class="screen">$ ant debug
</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Running-the-application-on-the-Android-emulator"></a>Running the application on the Android emulator</h4></div></div></div>
<p>First you need to create an <a class="ulink" href="http://developer.android.com/tools/devices" target="_top">Android Virtual Device (avd)</a>. Start:
</p>
<pre class="screen">android
</pre>
<p>Then from menu <code class="literal">Tools</code> select <code class="literal">Manage AVDs...</code>.
In the new window click <code class="literal">New....</code>
Pick a <code class="literal">Name</code> (we use <code class="literal">avd16</code> in the following),
a <code class="literal">Target</code> (to match <code class="literal">$ANDROID_PLATFORM</code>),
and optionally change the other properties, before clicking <code class="literal">Create AVD</code>.
</p>
<p>Now you can start up the Android emulator:
</p>
<pre class="screen">$ emulator -avd avd16 &amp;
</pre>
<p>Wait until Android has finished booting (you will see the Android home screen),
click the menu and home buttons. Now install our new application:
</p>
<pre class="screen">adb install bin/KawaHello-debug.apk
</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Running-the-application-on-your-device"></a>Running the application on your device</h4></div></div></div>
<p>If the emulator is running, kill it:
</p>
<pre class="screen">$ kill %emulator
</pre>
<p>On your phone or other Android devude, enable USB debugging.
(This is settable from the <code class="literal">Settings</code> application,
under <code class="literal">Applications / Development</code>.)
</p>
<p>Connect the phone to your computer with the USB cable.
Verify that the phone is accessible to <code class="literal">adb</code>:
</p>
<pre class="screen">$ adb devices
List of devices attached
0A3A560F0C015024	device
</pre>
<p>If you don't see a device listed, it may be permission problem. You can figure out which device corresponds to the phone by doing:
</p>
<pre class="screen">$ ls -l /dev/bus/usb/*
/dev/bus/usb/001:
total 0
...
crw-rw-rw- 1 root wheel 189, 5 2010-10-18 16:52 006
...
</pre>
<p>The timestamp corresponds to when you connected the phone.
Make the USB connection readable:
</p>
<pre class="screen">$ sudo chmod a+w /dev/bus/usb/001/006
</pre>
<p>Obviously if you spend time developing for an Androd phone you'll want to automate this process;
<a class="ulink" href="https://sites.google.com/site/siteofhx/Home/android/drivers/udc" target="_top">this link</a>
or <a class="ulink" href="https://groups.google.com/forum/?fromgroups=#!topic/android-developers/nTfhhPktGfM" target="_top">this link</a> may be helpful.
</p>
<p>Anyway, once <code class="literal">adb</code> can talk to the phone, you install in the same way as before:
</p>
<pre class="screen">adb install bin/KawaHello-debug.apk
</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Some-debugging-notes"></a>Some debugging notes</h4></div></div></div>
<p>You will find a copy of the SDK documentation in <code class="literal">$ANDROID_HOME/docs/index.html</code>.
</p>
<p>If the emulator complains that your application has stopped unexpectedly, do:
</p>
<pre class="screen">$ adb logcat
</pre>
<p>This shows log messages, stack traces, output from the <code class="literal">Log.i</code> logging method, and other useful information.
(You can alternatively start <code class="literal">ddms</code> (Dalvik Debug Monitor Service), click on the <code class="literal">kawa.android line</code> in the top-left sub-window to select it, then from the <code class="literal">Device</code> menu select <code class="literal">Run logcat....</code>).
</p>
<p>To uninstall your application, do:
</p>
<pre class="screen">$ adb uninstall kawa.android
</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Other-resources"></a>Other resources</h4></div></div></div>
<p>(A more interesting <a class="ulink" href="http://androidscheme.blogspot.com/2010/10/text-to-speech-app.html" target="_top">text-to-speech</a> example app is on Santosh Rajan's <a class="ulink" href="http://androidscheme.blogspot.com/" target="_top">Android-Scheme blog</a>.)
</p>
<p><a class="ulink" href="https://github.com/ecraven/SchemeAndroidOGL" target="_top">https://github.com/ecraven/SchemeAndroidOGL</a>
</p>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Android-view-construction"></a>Android view construction</h3></div></div></div>
<p>An Android user interface is constructed from <code class="literal">View</code> objects.
The following is an example that illustrates some features of
Kawa to help write views hierarchies,
The example is self-contained, and can be built and run
as described in <a class="xref" href="Miscellaneous.html#Building-for-Android" title="Kawa: Building for Android">the section called “Building for Android”</a>.
</p>
<pre class="screen">(require 'android-defs)
(activity hello
  (on-create-view
   (define counter ::integer 0)
   (define counter-view
     (TextView text: "Not clicked yet."))
   (LinearLayout orientation: LinearLayout:VERTICAL
    (TextView text: "Hello, Android from Kawa Scheme!")
    (Button
     text: "Click here!"
     on-click-listener: (lambda (e)
                          (set! counter (+ counter 1))
                          (counter-view:setText
                           (format "Clicked ~d times." counter))))
    counter-view)))
</pre>
<p>The first <code class="literal">import</code> form imports various useful definitions
from the Kawa Android library.  Using these is not required for
writing a Kawa application, but makes it more convenient.
</p>
<p>An Android application consists of one or more <em class="firstterm">activities</em>,
each of which is an instance of the <code class="literal">android.app.Activity</code> class.
You can use the <code class="literal">activity</code> macro to define your <code class="literal">Activity</code> class.
The first macro argument (in this case <code class="literal">hello</code>) is the class name,
and the others are members of the class, in the syntax of
a <a class="link" href="Objects-Classes-and-Modules.html#meta-field-or-method-decl"><em class="replaceable"><code>field-or-method-decl</code></em></a>.  The sub-form <code class="literal">on-create-view</code>
is an abbreviation for declaring an <code class="literal">onCreate</code> method
(which is called when the <code class="literal">Activity</code> starts up

followed by a <code class="literal">setContentView</code>:
The body of the <code class="literal">on-create-view</code> is evaluated.
The result should be a <code class="literal">View</code> expression,
which is passed to <code class="literal">setContentView</code>.
</p>
<p>The names <code class="literal">LinearLayout</code>, <code class="literal">TextView</code>, and <code class="literal">Button</code>
are just aliases for standard Android <code class="literal">View</code> sub-classes.
A few are prefined by <code class="literal">(require 'android-defs)</code>, or you
can define them yourself using <code class="literal">define-alias</code>.
</p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="View-object-allocation"></a>View object allocation</h4></div></div></div>
<p>To create an instance of a <code class="literal">View</code> class you “call” the
class as if it were a function,
as described in <a class="xref" href="Objects-Classes-and-Modules.html#Allocating-objects" title="Kawa: Allocating objects">the section called “Allocating objects”</a>.
For example:
</p>
<pre class="screen">(TextView (this) text: "Hello, Android from Kawa Scheme!")
</pre>
<p>If you <code class="literal">(require 'android-defs)</code> that defines
some special handling for <code class="literal">View</code> classes.
You can leave out the <code class="literal">(this)</code> argument,
which refers to the enclosing <code class="literal">Activity</code>:
</p>
<pre class="screen">(TextView text: "Hello, Android from Kawa Scheme!")
</pre>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Event-handlers"></a>Event handlers</h4></div></div></div>
<p>You can register event listeners on Android <code class="literal">View</code> objects
using methods typically named <code class="literal">setOn<em class="replaceable"><code>EVENT</code></em>Listener</code>.
For example <code class="literal">setOnClickListener</code>.  When allocating
an object you can leave out the <code class="literal">set</code>, and you can optionally
use Scheme-style names: <code class="literal">on-click-listener</code>.  The argument
is an object of a special nested listener class,
for example <code class="literal">View$OnClickListener</code>.  These are
single-method classes, so you can use a lambda expression
and <a class="xref" href="Objects-Classes-and-Modules.html#SAM-conversion">the section called “Anonymous classes”</a> will automatically create the needed
listener class.
</p>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="System-inquiry"></a>System inquiry</h3></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50318624"></a><code class="varname">home-directory</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>A string containing the home directory of the user.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50321616"></a><code class="function">command-line</code></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns a nonempty list of immutable strings. The first element is
an implementation-specific name for the running top-level
program.
The remaining elements are the command-line arguments,
as passed to the <code class="literal">main</code> method (except for those
flags processed by Kawa itself).
</p>
<p>The first element will depend on how the Kawa module was invoked.
Kawa uses the following rules to determine the command name:
</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
<p>If the property <code class="literal">kawa.command.name</code> is set, that is used.
This variable can be set on the <code class="literal">kawa</code> command line,
for example from a script:
</p>
<pre class="screen">kawa -Dkawa.command.name="$0" foo "$@"
</pre>
<p>This variable is also set implicitly by the meta-arg option.  FIXME.
</p>
</li>
<li class="listitem"><p>If we're reading a source file that starts with the Unix command-file prefix
‘<code class="literal">#!/</code>’ then we use the name of the source file.
The assumption is that such a file is an executable script.
</p></li>
<li class="listitem"><p>If the Java property <code class="literal">kawa.command.line</code> is set,
then we use that (after stripping off text that duplicates
the remaining arguments).
The <code class="literal">kawa</code> program sets this property to the
command line used to invoke it
(specifically the contents of the entire <code class="literal">argv</code> array),
before invoking the <code class="literal">java</code> program.
</p></li>
<li class="listitem"><p>If the Java property <code class="literal">sun.java.command</code> is set,
then we use that (after stripping off text that duplicates
the remaining arguments), and then prepending the string <code class="literal">"java "</code>.
The OpenJDK <code class="literal">java</code> program sets this property.
</p></li>
<li class="listitem"><p>If all else fails, the command name is <code class="literal">"kawa"</code>.
</p></li>
</ol></div>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50340112"></a><code class="varname">command-line-arguments</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>Any command-line arguments (following flags processed by Kawa itself)
are assigned to the global variable ‘<code class="literal">command-line-arguments</code>’,
which is a vector of strings.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50343904"></a><code class="function">process-command-line-assignments</code></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Process any initial command-line options that set variables.
These have the form <code class="literal"><em class="replaceable"><code>name</code></em>=<em class="replaceable"><code>value</code></em></code>.
Any such command-line options (at the start of the command-line)
are processed and removed from the command-line.
</p>
<pre class="screen">$ java kawa.repl -- abc=123 def
#|kawa:1|# (write (command-line))
("java kawa.repl --" "abc=123" "def")
#|kawa:2|# (process-command-line-assignments)
#|kawa:3|# (write (command-line))
("java kawa.repl -- abc=123" "def")
#|kawa:4|# abc
123
</pre>
<p>This function is mostly useful for Kawa applications
compiled with the <code class="literal">--main</code> option.
(It is used to set XQuery <code class="literal">external</code> variables.)
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50351376"></a><code class="function">get-environment-variable</code><em class="replaceable"><code> name</code></em></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Many operating systems provide each running process with
an environment conisting of environment variables.
(This environment is not to be confused with the
Scheme environments that can be passed to <code class="literal">eval</code>.)
Both the name and value of an environment variable are
strings. The procedure <code class="literal">get-environment-variable</code>
returns the value of the environment variable <em class="replaceable"><code>name</code></em>,
or <code class="literal">#f</code> if the environment variable is not found.


(This uses the <code class="literal">java.lang.System:getenv</code> method.)
It is an error to mutate the resulting string.
</p>
<pre class="screen">(get-environment-variable "PATH")
    ⇒ "/usr/local/bin:/usr/bin:/bin"
</pre>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50360016"></a><code class="function">get-environment-variables</code></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns the names and values of all the environment variables as an alist,
where the car of each entry is the name of an environment variable,
and the cdr is its value, both as strings.
It is an error to mutate any of the strings or the alist itself.
</p>
<pre class="screen">(get-environment-variables)
  ⇒ (("USER" . "root") ("HOME" . "/"))
</pre>
</blockquote></div>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Processes"></a>Processes</h3></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50365616"></a><code class="function">exit</code> [<em class="replaceable"><code>code</code></em>]</p>
<div class="blockquote"><blockquote class="blockquote">
<p>Exits the Kawa interpreter, and ends the Java session.
Returns the value of <em class="replaceable"><code>code</code></em> to the operating system:
The <em class="replaceable"><code>code</code></em> must be integer, or the special
values <code class="literal">#f</code> (equivalent to -1), or
<code class="literal">#t</code> (equivalent to 0).
If <em class="replaceable"><code>code</code></em> is not specified, zero is returned.
The <em class="replaceable"><code>code</code></em> is a status code; by convention a non-zero
value indicates a non-standard (error) return.
</p>
<p>Before exiting, finally-handlers (as in <code class="literal">try-finally</code>,
or the <em class="replaceable"><code>after</code></em> procedure of <code class="literal">dynamic-wind</code>) are
executed, but only in the current thread, and only if
the current thread was started normally. (Specifically
if we're inside an <code class="literal">ExitCalled</code> block with non-zero
nesting - see <code class="literal">gnu.kawa.util.ExitCalled</code>.)
Also, JVM shutdown hooks are executed - which includes
flushing buffers of output ports.  (Specifically
<code class="literal">Writer</code> objects registered with the <code class="literal">WriterManager</code>.)
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50378192"></a><code class="function">emergency-exit</code> [<em class="replaceable"><code>code</code></em>]</p>
<div class="blockquote"><blockquote class="blockquote"><p>Exits the Kawa interpreter, and ends the Java session.
Communicates an exit value in the same manner as <code class="literal">exit</code>.
Unlike <code class="literal">exit</code>, neither finally-handlers nor
shutdown hooks are executed.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50383552"></a><code class="function">make-process</code><em class="replaceable"><code> command</code></em><em class="replaceable"><code> envp</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Creates a <code class="literal">&lt;java.lang.Process&gt;</code> object, using the specified
<em class="replaceable"><code>command</code></em> and <em class="replaceable"><code>envp</code></em>.
The <em class="replaceable"><code>command</code></em> is converted to an array of Java strings
(that is an object that has type <code class="literal">&lt;java.lang.String[]&gt;</code>.
It can be a Scheme vector or list (whose elements should be
Java strings or Scheme strings);  a Java array of Java strings;
or a Scheme string.  In the latter case, the command is converted
using <code class="literal">command-parse</code>.
The <em class="replaceable"><code>envp</code></em> is process environment;  it should be either
a Java array of Java strings, or the special <code class="literal">#!null</code> value.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50392400"></a><code class="function">system</code><em class="replaceable"><code> command</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Runs the specified <em class="replaceable"><code>command</code></em>, and waits for it to finish.
Returns the return code from the command.  The return code is an integer,
where 0 conventionally means successful completion.
The <em class="replaceable"><code>command</code></em> can be any of the types handled by <code class="literal">make-process</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50397664"></a><code class="varname">command-parse</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>The value of this variable should be a one-argument procedure.
It is used to convert a command from a Scheme string to a Java
array of the constituent "words".
The default binding, on Unix-like systems, returns a new command to
invoke <code class="literal">"/bin/sh" "-c"</code> concatenated with the command string;
on non-Unix-systems, it is bound to <code class="literal">tokenize-string-to-string-array</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50402400"></a><code class="function">tokenize-string-to-string-array</code><em class="replaceable"><code> command</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Uses a <code class="literal">java.util.StringTokenizer</code> to parse the <em class="replaceable"><code>command</code></em> string
into an array of words.  This splits the <em class="replaceable"><code>command</code></em> using spaces
to delimit words; there is no special processing for quotes or other
special characters.
(This is the same as what <code class="literal">java.lang.Runtime.exec(String)</code> does.)
</p></blockquote></div>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Time-related-functions"></a>Time-related functions</h3></div></div></div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50409968"></a><code class="function">current-second</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns an inexact number represent the current time on the
<a class="ulink" href="http://en.wikipedia.org/wiki/International_Atomic_Time" target="_top">International Atomic Time (TAI)</a> scale.
The value 0.0 represents midnight on January 1, 1070 TAI (equivalent
to 10 seconds before midnight Universal Time), and
the value 1.0 represents on TAI second later.
Neither high acuracy nor high precision are required; in particular
returning Coordinated Universal Time plus a suitable
constant might be the best an implementation cat do.
The Kawa implementation just multiplies by 0.001 the result of calling
the method <code class="literal">currentTimeMillis</code> in class <code class="literal">java.lang.System</code>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50415840"></a><code class="function">current-jiffy</code></p>
<div class="blockquote"><blockquote class="blockquote">
<p>Returns the number of <em class="firstterm">jiffies</em> as an exact integer that have
elapses since an arbitrary implementation-defined epoch (instant).
A jiffy is an implementation-defined fraction of a second which is
defined by the return value of the <code class="literal">jiffies-per-second</code> procedure.
The starting epoch (instant 0) is guaranteed to be constant during
a run of the program, but may vary between runs.
(At the time of writing, Kawa's jiffy is one nano-second.)
</p>
<p><span class="emphasis"><em>Rationale:</em></span> Jiffies are allowed to be implementation-dependent
so that <code class="literal">current-jiffy</code> can execute with minimal overhead.
It should be very likely that a compactly represented integer will
suffice as the return value.  Any particular jiffy size will be
inappropriate some some implementations: a microsecond is too long for
a very fast machine, while a much smaller unit would force many
implementations to return integers which have to allocated for most calls,
rendering <code class="literal">current-jiffy</code> less useful for accurate timing measurements.
</p>
</blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50423200"></a><code class="function">jiffies-per-second</code></p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns an exact integer representing the number of jiffies
per SI second. This value is an implementation-specified
constant.
(At the time of writing, the value in Kawa is 1,000,000,000.)
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50426608"></a><code class="function">sleep</code><em class="replaceable"><code> time</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Suspends the current thread for the specified time.
The <em class="replaceable"><code>time</code></em> can be either a pure number (in secords),
or a quantity whose unit is a time unit (such as <code class="literal">10s</code>).
</p></blockquote></div>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="Low-level-functions"></a>Deprecated low-level functions</h3></div></div></div>
<p>These sections document older and less convenient ways
to call Java methods, access Java fields, and use Java arrays.
</p>
<p><a name="Low-level%20Method%20invocation"></a>
</p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Low-level-Method-invocation"></a>Low-level Method invocation</h4></div></div></div>
<p>The following lower-level primitives require you to specify
the parameter and return types explicitly.
You should probably use the functions <code class="literal">invoke</code> and <code class="literal">invoke-static</code>
(see <a class="xref" href="Objects-Classes-and-Modules.html#Method-operations" title="Kawa: Calling Java methods from Scheme">the section called “Calling Java methods from Scheme”</a>) instead.
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50437872"></a><code class="function">primitive-constructor</code><em class="replaceable"><code> class</code></em> (<em class="replaceable"><code>argtype</code></em><em class="replaceable"><code> ...</code></em>)</p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a new anonymous procedure, which when called will create
a new object of the specified class, and will then call the
constructor matching the specified argument types.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50442384"></a><code class="function">primitive-virtual-method</code><em class="replaceable"><code> class</code></em><em class="replaceable"><code> method</code></em><em class="replaceable"><code> rtype</code></em> (<em class="replaceable"><code>argtype</code></em><em class="replaceable"><code> ...</code></em>)</p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a new anonymous procedure, which when called will
invoke the instance method whose name is the string <em class="replaceable"><code>method</code></em>
in the class whose name is <em class="replaceable"><code>class</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50448320"></a><code class="function">primitive-static-method</code><em class="replaceable"><code> class</code></em><em class="replaceable"><code> method</code></em><em class="replaceable"><code> rtype</code></em> (<em class="replaceable"><code>argtype</code></em><em class="replaceable"><code> ...</code></em>)</p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a new anonymous procedure, which when called will
invoke the static method whose name is the string <em class="replaceable"><code>method</code></em>
in the class whose name is <em class="replaceable"><code>class</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50454224"></a><code class="function">primitive-interface-method</code><em class="replaceable"><code> interface</code></em><em class="replaceable"><code> method</code></em><em class="replaceable"><code> rtype</code></em> (<em class="replaceable"><code>argtype</code></em><em class="replaceable"><code> ...</code></em>)</p>
<div class="blockquote"><blockquote class="blockquote"><p>Returns a new anonymous procedure, which when called will
invoke the matching method from the interface whose name is <em class="replaceable"><code>interface</code></em>.
</p></blockquote></div>
</div>
<p>The macros return procedure values, just like <code class="literal">lambda</code>.
If the macros are used directly as the procedure of a procedure call,
then kawa can inline the correct bytecodes to call the specified methods.
(Note also that neither macro
checks that there really is a method that matches the specification.)
Otherwise, the Java reflection facility is used.
</p>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Low-level-field-operations"></a>Low-level field operations</h4></div></div></div>
<p>The following macros evaluate to procedures that can be used to
access or change the fields of objects or static fields.
The compiler can inline each to a single bytecode instruction
(not counting type conversion).
</p>
<p>These macros are deprecated.
The <code class="literal">fields</code> and <code class="literal">static-field</code> functions
(see <a class="xref" href="Objects-Classes-and-Modules.html#Field-operations" title="Kawa: Accessing object fields">the section called “Accessing object fields”</a>) are easier to use, more powerful, and
just as efficient.  However, the high-level functions currently do
not provide access to non-public fields.
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50465504"></a><code class="function">primitive-get-field</code><em class="replaceable"><code> class</code></em><em class="replaceable"><code> fname</code></em><em class="replaceable"><code> ftype</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Use this to access a field named <em class="replaceable"><code>fname</code></em> having type <em class="replaceable"><code>type</code></em> in
class <em class="replaceable"><code>class</code></em>.  Evaluates to a new one-argument procedure,
whose argument is a reference to an object of the specified <em class="replaceable"><code>class</code></em>.
Calling that procedure returns the value of the specified field.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50471552"></a><code class="function">primitive-set-field</code><em class="replaceable"><code> class</code></em><em class="replaceable"><code> fname</code></em><em class="replaceable"><code> ftype</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Use this to change a field named <em class="replaceable"><code>fname</code></em> having type <em class="replaceable"><code>type</code></em> in
class <em class="replaceable"><code>class</code></em>.  Evaluates to a new two-argument procedure,
whose first argument is a reference to an object of the
specified <em class="replaceable"><code>class</code></em>, and the second argument is the new value.
Calling that procedure sets the field to the specified value.
(This macro's name does not end in a ‘<code class="literal">!</code>’, because it does not actually
set the field.  Rather, it returns a function for setting the field.)
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50478464"></a><code class="function">primitive-get-static</code><em class="replaceable"><code> class</code></em><em class="replaceable"><code> fname</code></em><em class="replaceable"><code> ftype</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Like <code class="literal">primitive-get-field</code>, but used to access static fields.
Returns a zero-argument function, which when called returns
the value of the static field.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50483392"></a><code class="function">primitive-set-static</code><em class="replaceable"><code> class</code></em><em class="replaceable"><code> fname</code></em><em class="replaceable"><code> ftype</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Like <code class="literal">primitive-set-field</code>, but used to modify static fields.
Returns a one-argument function, which when called sets the
value of the static field to the argument.
</p></blockquote></div>
</div>
<p><a name="Low-level%20array%20macros"></a>
</p>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="Old-low-level-array-macros"></a>Old low-level array macros</h4></div></div></div>
<p>The following macros evaluate to procedures that can be used to
manipulate primitive Java array objects.
The compiler can inline each to a single bytecode instruction
(not counting type conversion).
</p>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50490816"></a><code class="function">primitive-array-new</code><em class="replaceable"><code> element-type</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Evaluates to a one-argument procedure.  Applying the resulting procedure to
an integer count allocates a new Java array of the specified length,
and whose elements have type <em class="replaceable"><code>element-type</code></em>.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50494912"></a><code class="function">primitive-array-set</code><em class="replaceable"><code> element-type</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Evaluates to a three-argument procedure.  The first argument of
the resulting procedure must be an array whose elements have type
<em class="replaceable"><code>element-type</code></em>;  the second argument is an index;  and the third
argument is a value (coercible to <em class="replaceable"><code>element-type</code></em>) which replaces
the value specified by the index in the given array.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50499552"></a><code class="function">primitive-array-get</code><em class="replaceable"><code> element-type</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Evaluates to a two-argument procedure.  The first argument of
the resulting procedure must be an array whose elements have type
<em class="replaceable"><code>element-type</code></em>;  the second argument is an index.
Applying the procedure returns the element at the specified index.
</p></blockquote></div>
</div>
<div class="informalfigure">
<p class="synopsis"><a class="indexterm" name="idp50503712"></a><code class="function">primitive-array-length</code><em class="replaceable"><code> element-type</code></em></p>
<div class="blockquote"><blockquote class="blockquote"><p>Evaluates to a one-argument procedure.  The argument of
the resulting procedure must be an array whose elements have type
<em class="replaceable"><code>element-type</code></em>.
Applying the procedure returns the length of the array.
(Alternatively, you can use <code class="literal">(field <em class="replaceable"><code>array</code></em> 'length)</code>.)
</p></blockquote></div>
</div>
</div>
</div>
</div>
<div class="navfooter">
<ul>
<li><b class="toc"><a href="Miscellaneous.html#Building-JavaFX-applications">Building JavaFX applications</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Building-for-Android">Building for Android</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Android-view-construction">Android view construction</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#System-inquiry">System inquiry</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Processes">Processes</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Time-related-functions">Time-related functions</a></b></li>
<li><b class="toc"><a href="Miscellaneous.html#Low-level-functions">Deprecated low-level functions</a></b></li>
</ul>
<p>
          Up: <a accesskey="u" href="Documentation.html">Documentation</a></p>
<p>
        Previous: <a accesskey="p" href="XML-tools.html">Working with XML and HTML</a></p>
</div>
</div>
 </body>
</html>
